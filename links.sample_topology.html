<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SPS Network Topology - Interactive Visualization</title>
    <script src="https://d3js.org/d3.v7.min.js"></script>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 0;
            padding: 0;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            overflow: hidden;
        }
        
        .container {
            display: flex;
            flex-direction: column;
            height: 100vh;
        }
        
        .header {
            padding: 10px 20px;
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border-bottom: 1px solid rgba(255, 255, 255, 0.2);
        }
        
        h1 {
            margin: 0;
            font-size: 1.8em;
            text-align: center;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }
        
        .controls {
            display: flex;
            justify-content: center;
            gap: 10px;
            margin: 8px 0;
            flex-wrap: wrap;
        }
        
        .control-group {
            background: rgba(255, 255, 255, 0.1);
            padding: 5px 10px;
            border-radius: 15px;
            backdrop-filter: blur(5px);
            font-size: 0.9em;
        }
        
        .search-group {
            background: rgba(255, 255, 255, 0.15);
            padding: 8px 12px;
            border-radius: 15px;
            backdrop-filter: blur(5px);
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .search-input {
            background: rgba(255, 255, 255, 0.2);
            border: 1px solid rgba(255, 255, 255, 0.3);
            color: white;
            padding: 4px 8px;
            border-radius: 10px;
            font-size: 0.9em;
            min-width: 150px;
        }
        
        .search-input::placeholder {
            color: rgba(255, 255, 255, 0.7);
        }
        
        .checkbox-wrapper {
            display: flex;
            align-items: center;
            gap: 4px;
            font-size: 0.8em;
        }
        
        input[type="checkbox"] {
            accent-color: #4ECDC4;
        }
        
        .filter-status {
            background: rgba(74, 144, 226, 0.3);
            padding: 4px 8px;
            border-radius: 8px;
            font-size: 0.75em;
            margin-left: 8px;
        }
        
        button {
            background: linear-gradient(45deg, #ff6b6b, #ff8e8e);
            border: none;
            color: white;
            padding: 4px 12px;
            border-radius: 15px;
            cursor: pointer;
            margin: 0 3px;
            font-weight: bold;
            transition: all 0.3s ease;
            font-size: 0.85em;
        }
        
        button:hover {
            transform: translateY(-1px);
            box-shadow: 0 3px 10px rgba(0,0,0,0.3);
        }
        
        button.active {
            background: linear-gradient(45deg, #4ECDC4, #44A08D);
        }
        
        .layout-btn {
            width: 35px;
            height: 35px;
            border-radius: 50%;
            background: linear-gradient(45deg, #667eea, #764ba2);
            border: 1px solid rgba(255, 255, 255, 0.3);
            color: white;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s ease;
        }
        
        .layout-btn:hover {
            background: linear-gradient(45deg, #5a67d8, #6b46c1);
            transform: scale(1.1);
        }
        
        .stats {
            display: flex;
            justify-content: center;
            gap: 10px;
            margin: 5px 0;
        }
        
        .stat-card {
            background: rgba(255, 255, 255, 0.15);
            padding: 8px 12px;
            border-radius: 8px;
            text-align: center;
            backdrop-filter: blur(5px);
            font-size: 0.8em;
        }
        
        .stat-number {
            font-size: 1.4em;
            font-weight: bold;
            color: #4ECDC4;
        }
        
        @keyframes ledBreathing {
            0% { 
                stroke: #FF0080;
                stroke-width: 2px;
                filter: drop-shadow(0 0 3px #FF0080);
            }
            14% { 
                stroke: #FF4000;
                stroke-width: 3px;
                filter: drop-shadow(0 0 6px #FF4000);
            }
            28% { 
                stroke: #FFFF00;
                stroke-width: 4px;
                filter: drop-shadow(0 0 8px #FFFF00);
            }
            42% { 
                stroke: #00FF00;
                stroke-width: 3px;
                filter: drop-shadow(0 0 6px #00FF00);
            }
            56% { 
                stroke: #0080FF;
                stroke-width: 4px;
                filter: drop-shadow(0 0 8px #0080FF);
            }
            70% { 
                stroke: #8000FF;
                stroke-width: 3px;
                filter: drop-shadow(0 0 6px #8000FF);
            }
            84% { 
                stroke: #FF0040;
                stroke-width: 2px;
                filter: drop-shadow(0 0 4px #FF0040);
            }
            100% { 
                stroke: #FF0080;
                stroke-width: 2px;
                filter: drop-shadow(0 0 3px #FF0080);
            }
        }
        
        .node.search-match {
            animation: ledBreathing 2s infinite;
        }
        
        @keyframes flowPulse {
            0%, 100% { stroke-width: 2px; stroke: rgba(255, 255, 255, 0.4); }
            50% { stroke-width: 4px; stroke: rgba(255, 255, 255, 0.8); }
        }
        
        .link.flow-active {
            animation: flowPulse 1.5s infinite;
        }
        
        @keyframes searchPulse {
            0%, 100% { transform: scale(1); opacity: 1; }
            50% { transform: scale(1.2); opacity: 0.7; }
        }
        
        .search-highlight {
            animation: searchPulse 1s infinite;
        }
        
        .main-content {
            flex: 1;
            position: relative;
            overflow: hidden;
        }
        
        #topology {
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.1);
            cursor: grab;
        }
        
        #topology:active {
            cursor: grabbing;
        }
        
        .tooltip {
            position: absolute;
            background: rgba(0, 0, 0, 0.9);
            color: white;
            padding: 10px;
            border-radius: 8px;
            pointer-events: none;
            font-size: 11px;
            max-width: 280px;
            z-index: 1000;
            border: 1px solid rgba(255, 255, 255, 0.3);
        }
        
        .tooltip h4 {
            margin: 0 0 6px 0;
            color: #4ECDC4;
            font-size: 13px;
        }
        
        .tooltip-content {
            display: grid;
            grid-template-columns: auto 1fr;
            gap: 3px 6px;
            font-size: 10px;
        }
        
        .legend {
            position: absolute;
            bottom: 10px;
            left: 10px;
            background: rgba(0, 0, 0, 0.8);
            padding: 10px;
            border-radius: 8px;
            backdrop-filter: blur(10px);
            max-width: 200px;
        }
        
        .legend-item {
            display: flex;
            align-items: center;
            gap: 6px;
            margin: 3px 0;
            font-size: 11px;
        }
        
        .legend-circle {
            width: 10px;
            height: 10px;
            border-radius: 50%;
            border: 1px solid rgba(255, 255, 255, 0.5);
        }

        .metadata-legend {
            position: absolute;
            top: 10px;
            left: 10px;
            background: rgba(0, 0, 0, 0.8);
            padding: 10px;
            border-radius: 8px;
            backdrop-filter: blur(10px);
            max-width: 220px;
            font-size: 10px;
            color: white;
            z-index: 1000;
        }
        
        .metadata-legend h4 {
            margin: 0 0 8px 0;
            color: #4ECDC4;
            font-size: 12px;
            font-weight: bold;
        }
        
        .metadata-item {
            margin: 4px 0;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .metadata-label {
            color: #cccccc;
            font-weight: normal;
        }
        
        .metadata-value {
            color: #ffffff;
            font-weight: bold;
        }
        
        .metadata-section {
            margin-bottom: 10px;
            padding-bottom: 8px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.2);
        }
        
        .metadata-section:last-child {
            border-bottom: none;
            margin-bottom: 0;
        }
        
        .zoom-controls {
            position: absolute;
            top: 10px;
            right: 10px;
            display: flex;
            flex-direction: column;
            gap: 5px;
        }
        
        .zoom-btn {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: rgba(0, 0, 0, 0.7);
            border: 1px solid rgba(255, 255, 255, 0.3);
            color: white;
            font-size: 18px;
            font-weight: bold;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .zoom-btn:hover {
            background: rgba(0, 0, 0, 0.9);
        }
        
        .scale-controls {
            position: absolute;
            top: 10px;
            left: 250px;
            display: flex;
            flex-direction: column;
            gap: 3px;
        }
        
        .scale-btn {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: rgba(76, 175, 80, 0.7);
            border: 1px solid rgba(255, 255, 255, 0.3);
            color: white;
            font-size: 18px;
            font-weight: bold;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s ease;
        }
        
        .scale-btn:hover {
            background: rgba(76, 175, 80, 0.9);
            transform: scale(1.1);
        }
        
        .node {
            stroke: rgba(255, 255, 255, 0.8);
            stroke-width: 2px;
            cursor: pointer;
            transition: all 0.2s ease;
        }
        
        .node:hover {
            stroke-width: 3px;
            stroke: #FFD700;
        }
        
        .node.selected {
            stroke: #FFD700;
            stroke-width: 4px;
            filter: drop-shadow(0 0 8px #FFD700);
        }
        
        .link {
            stroke: rgba(255, 255, 255, 0.4);
            stroke-width: 2;
            transition: all 0.2s ease;
        }
        
        .link:hover {
            stroke: rgba(255, 255, 255, 0.8);
            stroke-width: 3;
        }
        
        .node-label {
            fill: white;
            font-size: 9px;
            font-weight: bold;
            text-anchor: middle;
            pointer-events: none;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.7);
            dominant-baseline: middle;
        }
        
        .node-label tspan {
            dominant-baseline: middle;
        }
        
        .node-label-group {
            pointer-events: none;
        }
        
        .filtered {
            opacity: 0.2 !important;
        }
        
        .highlighted {
            opacity: 1 !important;
        }
        
        .selection-rect {
            fill: rgba(255, 215, 0, 0.2);
            stroke: #FFD700;
            stroke-width: 2;
            stroke-dasharray: 5,5;
            pointer-events: none;
        }
        
        .context-menu {
            position: absolute;
            background: rgba(0, 0, 0, 0.95);
            border: 1px solid rgba(255, 255, 255, 0.3);
            border-radius: 6px;
            padding: 8px 0;
            z-index: 1000;
            backdrop-filter: blur(10px);
            min-width: 180px;
        }
        
        .context-menu-item {
            padding: 6px 12px;
            color: white;
            cursor: pointer;
            font-size: 12px;
            transition: background 0.2s ease;
        }
        
        .context-menu-item:hover {
            background: rgba(255, 255, 255, 0.1);
        }
        
        .context-menu-separator {
            height: 1px;
            background: rgba(255, 255, 255, 0.2);
            margin: 4px 0;
        }
        
        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            background: rgba(0, 0, 0, 0.9);
            color: white;
            padding: 10px 15px;
            border-radius: 6px;
            z-index: 2000;
            border: 1px solid rgba(255, 255, 255, 0.3);
            backdrop-filter: blur(10px);
            transform: translateX(100%);
            transition: transform 0.3s ease;
        }
        
        .notification.show {
            transform: translateX(0);
        }
        
        .flow-path {
            stroke: #FFD700 !important;
            stroke-width: 4px !important;
            opacity: 1 !important;
            filter: drop-shadow(0 0 6px #FFD700);
        }
        
        /* Modal Backdrop */
        .modal-backdrop {
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            background: rgba(0, 0, 0, 0.5);
            z-index: 9999;
            backdrop-filter: blur(5px);
        }
        
        /* Metadata Panel Styles */
        .metadata-panel {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(0, 0, 0, 0.95);
            border: 2px solid rgba(255, 255, 255, 0.3);
            border-radius: 15px;
            padding: 0;
            width: 90vw;
            height: 80vh;
            max-width: 1200px;
            max-height: 800px;
            min-width: 600px;
            min-height: 400px;
            overflow: hidden;
            z-index: 10000;
            backdrop-filter: blur(10px);
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.7);
            display: flex;
            flex-direction: column;
        }
        
        .metadata-header {
            background: linear-gradient(45deg, #667eea, #764ba2);
            padding: 15px 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 1px solid rgba(255, 255, 255, 0.2);
        }
        
        .metadata-header h3 {
            margin: 0;
            color: white;
            font-size: 1.2em;
        }
        
        .close-btn {
            background: rgba(255, 255, 255, 0.2);
            border: 1px solid rgba(255, 255, 255, 0.3);
            color: white;
            padding: 5px 10px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 1.1em;
        }
        
        .close-btn:hover {
            background: rgba(255, 0, 0, 0.3);
        }
        
        .metadata-content {
            padding: 20px;
            flex: 1;
            overflow-y: auto;
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
        }
        
        .metadata-section {
            background: rgba(255, 255, 255, 0.05);
            padding: 15px;
            border-radius: 10px;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .metadata-section h4 {
            margin: 0 0 10px 0;
            color: #4ECDC4;
            font-size: 1em;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            padding-bottom: 5px;
        }
        
        .metadata-list {
            background: rgba(0, 0, 0, 0.3);
            padding: 10px;
            border-radius: 5px;
            font-family: 'Courier New', monospace;
            font-size: 0.9em;
            max-height: 200px;
            overflow-y: auto;
            margin-bottom: 10px;
            border: 1px solid rgba(255, 255, 255, 0.1);
            word-wrap: break-word;
        }
        
        .copy-btn {
            background: linear-gradient(45deg, #27AE60, #2ECC71);
            border: none;
            color: white;
            padding: 5px 10px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 0.8em;
            transition: all 0.3s ease;
        }
        
        .copy-btn:hover {
            background: linear-gradient(45deg, #2ECC71, #27AE60);
            transform: translateY(-1px);
        }
        
        .stat-card {
            background: rgba(255, 255, 255, 0.15);
            padding: 8px 12px;
            border-radius: 8px;
            text-align: center;
            backdrop-filter: blur(5px);
            font-size: 0.8em;
            transition: all 0.3s ease;
        }
        
        .stat-card:hover {
            background: rgba(255, 255, 255, 0.25);
            transform: translateY(-2px);
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>🌟 SPS Network Topology - Interactive Visualization</h1>
            
            <div class="stats">
                <div class="stat-card">
                    <div class="stat-number">86</div>
                    <div>Nodes</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number">85</div>
                    <div>Links</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number">4</div>
                    <div>Protocols</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number">18</div>
                    <div>Entities</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number">17</div>
                    <div>IP Addresses</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number">23</div>
                    <div>Ports</div>
                </div>
            </div>
            
            <div class="controls">
                <div class="search-group">
                    <input type="text" class="search-input" id="searchInput" placeholder="Search nodes (keywords or RegExp)..." oninput="handleSearch()" title="Search nodes by name or details. Use RegExp for advanced patterns.">
                    <div class="checkbox-wrapper">
                        <input type="checkbox" id="regexCheckbox" onchange="handleSearch()">
                        <label for="regexCheckbox">RegExp</label>
                    </div>
                    <button onclick="clearSearch()" style="padding: 2px 8px; font-size: 0.8em;" title="Clear search filter only">Clear Search</button>
                    <button onclick="clearAllFilters()" style="padding: 2px 8px; font-size: 0.8em; margin-left: 4px;" title="Clear both search and protocol filters">Clear All</button>
                    <span class="filter-status" id="filterStatus">No filter</span>
                </div>
            </div>
            
            <div class="controls">
                <div class="control-group">
                    <label>Controls:</label>
                    <button onclick="restartSimulation()">🔄 Restart</button>
                    <button onclick="centerView()">🎯 Center</button>
                    <button onclick="toggleLabels()" id="labelBtn">🏷️ Labels</button>
                    <button onclick="clearSelection()">🔓 Clear Selection</button>
                </div>
                <div class="control-group">
                    <label>View:</label>
                    <button onclick="filterProtocol('DIAMETER')" id="btn_DIAMETER" class="protocol-btn" title="Filter by DIAMETER protocol. Combines with search if active.">DIAMETER</button> <button onclick="filterProtocol('MTP')" id="btn_MTP" class="protocol-btn" title="Filter by MTP protocol. Combines with search if active.">MTP</button> <button onclick="filterProtocol('M3UA')" id="btn_M3UA" class="protocol-btn" title="Filter by M3UA protocol. Combines with search if active.">M3UA</button> <button onclick="filterProtocol('M2UA')" id="btn_M2UA" class="protocol-btn" title="Filter by M2UA protocol. Combines with search if active.">M2UA</button>
                    <button onclick="showAll()" id="btnAll" class="protocol-btn active" title="Show all protocols. Preserves search filter if active.">All</button>
                </div>
            </div>
        </div>
        
        <div class="main-content">
            <svg id="topology"></svg>
            
            <div class="zoom-controls">
                <div class="zoom-btn" onclick="zoomIn()">+</div>
                <div class="zoom-btn" onclick="zoomOut()">−</div>
                <div class="zoom-btn" onclick="resetZoom()" style="font-size: 14px;">⌂</div>
            </div>
            
            <div class="legend">
                <div style="font-weight: bold; margin-bottom: 6px; color: #3498DB;">Network Protocol Colors</div>
                <div class="legend-item">
                    <div class="legend-circle" style="background: #2C3E50;"></div>
                    <span>SPS Core</span>
                </div>
                <div class="legend-item">
                    <div class="legend-circle" style="background: #E74C3C;"></div>
                    <span>Diameter Protocol</span>
                </div>
                <div class="legend-item">
                    <div class="legend-circle" style="background: #3498DB;"></div>
                    <span>MTP Protocol</span>
                </div>
                <div class="legend-item">
                    <div class="legend-circle" style="background: #27AE60;"></div>
                    <span>M3UA Protocol</span>
                </div>
                <div class="legend-item">
                    <div class="legend-circle" style="background: #F39C12;"></div>
                    <span>M2UA Protocol</span>
                </div>
                <div class="legend-item">
                    <div class="legend-circle" style="background: #9B59B6;"></div>
                    <span>SCCP Protocol</span>
                </div>
                <div style="margin-top: 8px; padding-top: 6px; border-top: 1px solid rgba(255,255,255,0.2); font-size: 9px;">
                    <div style="color: #3498DB; font-weight: bold; margin-bottom: 3px;">Node Information:</div>
                    <div>• Hover over nodes for detailed information</div>
                    <div>• Link labels show IP:Port connections</div>
                    <div>• Click Metadata for IP/Port summaries</div>
                </div>
                <div style="margin-top: 6px; padding-top: 4px; border-top: 1px solid rgba(255,255,255,0.2); font-size: 9px;">
                    <div style="color: #3498DB; font-weight: bold; margin-bottom: 3px;">Search Features:</div>
                    <div>• LED Breathing: Primary search matches</div>
                    <div>• Highlighted: Parent/child relationships</div>
                    <div>• Filtered: Non-matching nodes (dimmed)</div>
                </div>
                <div style="margin-top: 6px; padding-top: 4px; border-top: 1px solid rgba(255,255,255,0.2); font-size: 9px;">
                    <div style="color: #3498DB; font-weight: bold; margin-bottom: 3px;">Layout Controls:</div>
                    <div>• Scale Out (⬌): Expand node spacing</div>
                    <div>• Scale In (⬍): Contract node spacing</div>
                    <div>• Reset Scale (⌂): Restore default spacing</div>
                    <div>• Zoom In (+): Increase view scale</div>
                    <div>• Zoom Out (−): Decrease view scale</div>
                    <div>• Reset Zoom (⌂): Restore default view</div>
                </div>
                <div style="margin-top: 6px; padding-top: 4px; border-top: 1px solid rgba(255,255,255,0.2); font-size: 9px;">
                    <div style="color: #4ECDC4; font-weight: bold; margin-bottom: 3px;">Metadata Panel:</div>
                    <div>• Right-click for copy options</div>
                    <div>• Copy all metadata, IPs, ports</div>
                    <div>• Export network statistics</div>
                </div>
                <div style="margin-top: 6px; padding-top: 4px; border-top: 1px solid rgba(255,255,255,0.2); font-size: 9px;">
                    <div style="color: #3498DB; font-weight: bold; margin-bottom: 3px;">Shortcuts:</div>
                    <div>• Ctrl+F: Focus search</div>
                    <div>• Ctrl+A: Select all nodes</div>
                    <div>• Esc: Clear search/selection</div>
                    <div>• Shift+Click: Multi-select</div>
                    <div>• Ctrl+Drag: Rectangle select</div>
                </div>
            </div>
            
            <!-- Metadata Legend - Bottom Right Corner -->
            <div class="metadata-legend" oncontextmenu="showMetadataContextMenu(event)">
                <h4>📊 Network Metadata</h4>
                <div class="metadata-section">
                    <div class="metadata-item">
                        <span class="metadata-label">📍 IP Addresses:</span>
                        <span class="metadata-value">17</span>
                    </div>
                    <div class="metadata-item">
                        <span class="metadata-label">🔌 Ports:</span>
                        <span class="metadata-value">23</span>
                    </div>
                    <div class="metadata-item">
                        <span class="metadata-label">🔗 IP:Port Pairs:</span>
                        <span class="metadata-value">33</span>
                    </div>
                </div>
                <div class="metadata-section">
                    <div class="metadata-item">
                        <span class="metadata-label">🌐 Connections:</span>
                        <span class="metadata-value">43</span>
                    </div>
                    <div class="metadata-item">
                        <span class="metadata-label">🏠 Nodes:</span>
                        <span class="metadata-value">86</span>
                    </div>
                    <div class="metadata-item">
                        <span class="metadata-label">🔗 Links:</span>
                        <span class="metadata-value">85</span>
                    </div>
                </div>
            </div>
            
            <!-- Scale Controls -->
            <div class="scale-controls">
                <div class="scale-btn" onclick="scaleOut()" title="Scale Out - Increase node spacing">⬌</div>
                <div class="scale-btn" onclick="scaleIn()" title="Scale In - Decrease node spacing">⬍</div>
                <div class="scale-btn" onclick="resetScale()" title="Reset Scale" style="font-size: 14px;">⌂</div>
            </div>
        </div>
    </div>

    <script>

        
        // Data
        const nodes = [
        {
                "id": "SPS_LOCAL",
                "name": "SPS_LOCAL",
                "type": "SPS_CORE",
                "layer": 0,
                "x": 0,
                "y": 0,
                "fx": 0,
                "fy": 0,
                "color": "#2C3E50",
                "size": 40,
                "shape": "star",
                "description": "Local SPS Entity",
                "protocols": [
                        "DIAMETER",
                        "MTP",
                        "M2UA"
                ],
                "details": {
                        "Total Connections": 18,
                        "Entity Type": "SPS Core System",
                        "Location": "Local Entity",
                        "Protocols": "DIAMETER, MTP, M2UA"
                }
        },
        {
                "id": "node_0001",
                "name": "MME",
                "type": "DIAMETER_PEER",
                "layer": 1,
                "parent": null,
                "x": 180.0,
                "y": 0.0,
                "color": "#E74C3C",
                "size": 25,
                "shape": "circle",
                "details": {
                        "Node Type": "DIAMETER_PEER",
                        "Layer": 1,
                        "Hostname": "mme.huawei.com",
                        "Realm": "huawei.com",
                        "Interface": "S6a/S6d-1",
                        "Protocol Type": "DIAMETER"
                },
                "hostname": "mme.huawei.com",
                "realm": "huawei.com",
                "interface": "S6a/S6d-1",
                "protocol_type": "DIAMETER",
                "host_ip": "",
                "port": ""
        },
        {
                "id": "node_0002",
                "name": "HSS",
                "type": "DIAMETER_PEER",
                "layer": 1,
                "parent": null,
                "x": 127.27922061357856,
                "y": 127.27922061357856,
                "color": "#E74C3C",
                "size": 25,
                "shape": "circle",
                "details": {
                        "Node Type": "DIAMETER_PEER",
                        "Layer": 1,
                        "Hostname": "hss.huawei.com",
                        "Realm": "huawei.com",
                        "Interface": "S6a/S6d-1",
                        "Protocol Type": "DIAMETER"
                },
                "hostname": "hss.huawei.com",
                "realm": "huawei.com",
                "interface": "S6a/S6d-1",
                "protocol_type": "DIAMETER",
                "host_ip": "",
                "port": ""
        },
        {
                "id": "node_0003",
                "name": "SPS_A_MME_DMLKS01",
                "type": "DIAMETER_LINKSET",
                "layer": 2,
                "parent": "node_0001",
                "x": 260.0,
                "y": 0.0,
                "color": "#E74C3C",
                "size": 18,
                "shape": "rect",
                "details": {
                        "Node Type": "DIAMETER_LINKSET",
                        "Layer": 2,
                        "Peer Name": "MME",
                        "Da Name": "SPS_A",
                        "Load Sharing Mode": "ROUND-ROBIN"
                },
                "peer_name": "MME",
                "da_name": "SPS_A",
                "load_sharing_mode": "ROUND-ROBIN"
        },
        {
                "id": "node_0004",
                "name": "SPS_A_HSS_DMLKS01",
                "type": "DIAMETER_LINKSET",
                "layer": 2,
                "parent": "node_0002",
                "x": 183.84776310850236,
                "y": 183.84776310850236,
                "color": "#E74C3C",
                "size": 18,
                "shape": "rect",
                "details": {
                        "Node Type": "DIAMETER_LINKSET",
                        "Layer": 2,
                        "Peer Name": "HSS",
                        "Da Name": "SPS_A",
                        "Load Sharing Mode": "ROUND-ROBIN"
                },
                "peer_name": "HSS",
                "da_name": "SPS_A",
                "load_sharing_mode": "ROUND-ROBIN"
        },
        {
                "id": "node_0005",
                "name": "SPS_A_MME_DMLNK01\nLocal:5005 \u27f7 172.21.1.101:5005",
                "type": "DIAMETER_LINK",
                "layer": 3,
                "parent": "node_0003",
                "x": 340.0,
                "y": 0.0,
                "color": "#E74C3C",
                "size": 12,
                "shape": "triangle",
                "details": {
                        "Node Type": "DIAMETER_LINK",
                        "Layer": 3,
                        "Mid": "502",
                        "Protocol Type": "SCTP",
                        "Working Mode": "SERVER",
                        "Peer Ip": "172.21.1.101",
                        "Peer Port": "5005",
                        "Local Port": "5005",
                        "Connection": "Local:5005 \u27f7 172.21.1.101:5005"
                },
                "mid": "502",
                "protocol_type": "SCTP",
                "working_mode": "SERVER",
                "peer_ip": "172.21.1.101",
                "peer_port": "5005",
                "local_port": "5005",
                "connection": "Local:5005 \u27f7 172.21.1.101:5005"
        },
        {
                "id": "node_0006",
                "name": "SPS_A_HSS_DMLNK01\nLocal:5006 \u27f7 172.21.1.102:5006",
                "type": "DIAMETER_LINK",
                "layer": 3,
                "parent": "node_0004",
                "x": 240.41630560342617,
                "y": 240.41630560342617,
                "color": "#E74C3C",
                "size": 12,
                "shape": "triangle",
                "details": {
                        "Node Type": "DIAMETER_LINK",
                        "Layer": 3,
                        "Mid": "503",
                        "Protocol Type": "SCTP",
                        "Working Mode": "SERVER",
                        "Peer Ip": "172.21.1.102",
                        "Peer Port": "5006",
                        "Local Port": "5006",
                        "Connection": "Local:5006 \u27f7 172.21.1.102:5006"
                },
                "mid": "503",
                "protocol_type": "SCTP",
                "working_mode": "SERVER",
                "peer_ip": "172.21.1.102",
                "peer_port": "5006",
                "local_port": "5006",
                "connection": "Local:5006 \u27f7 172.21.1.102:5006"
        },
        {
                "id": "node_0007",
                "name": "SPS_A_MME_DMLNK02\nLocal:5007 \u27f7 172.21.1.101:5007",
                "type": "DIAMETER_LINK",
                "layer": 3,
                "parent": "node_0003",
                "x": 2.0818995585505004e-14,
                "y": 340.0,
                "color": "#E74C3C",
                "size": 12,
                "shape": "triangle",
                "details": {
                        "Node Type": "DIAMETER_LINK",
                        "Layer": 3,
                        "Mid": "506",
                        "Protocol Type": "SCTP",
                        "Working Mode": "SERVER",
                        "Peer Ip": "172.21.1.101",
                        "Peer Port": "5007",
                        "Local Port": "5007",
                        "Connection": "Local:5007 \u27f7 172.21.1.101:5007"
                },
                "mid": "506",
                "protocol_type": "SCTP",
                "working_mode": "SERVER",
                "peer_ip": "172.21.1.101",
                "peer_port": "5007",
                "local_port": "5007",
                "connection": "Local:5007 \u27f7 172.21.1.101:5007"
        },
        {
                "id": "node_0008",
                "name": "SPS_A_HSS_DMLNK02\nLocal:5008 \u27f7 172.21.1.102:5008",
                "type": "DIAMETER_LINK",
                "layer": 3,
                "parent": "node_0004",
                "x": -240.41630560342614,
                "y": 240.41630560342617,
                "color": "#E74C3C",
                "size": 12,
                "shape": "triangle",
                "details": {
                        "Node Type": "DIAMETER_LINK",
                        "Layer": 3,
                        "Mid": "507",
                        "Protocol Type": "SCTP",
                        "Working Mode": "SERVER",
                        "Peer Ip": "172.21.1.102",
                        "Peer Port": "5008",
                        "Local Port": "5008",
                        "Connection": "Local:5008 \u27f7 172.21.1.102:5008"
                },
                "mid": "507",
                "protocol_type": "SCTP",
                "working_mode": "SERVER",
                "peer_ip": "172.21.1.102",
                "peer_port": "5008",
                "local_port": "5008",
                "connection": "Local:5008 \u27f7 172.21.1.102:5008"
        },
        {
                "id": "node_0009",
                "name": "M2PA_SPS_B_01",
                "type": "MTP_DSP",
                "layer": 1,
                "parent": null,
                "x": 1.1021821192326179e-14,
                "y": 180.0,
                "color": "#3498DB",
                "size": 25,
                "shape": "hexagon",
                "details": {
                        "Node Type": "MTP_DSP",
                        "Layer": 1,
                        "Point Code": "000806",
                        "Network": "default",
                        "Sua Point": "FALSE"
                },
                "point_code": "000806",
                "network": "default",
                "sua_point": "FALSE"
        },
        {
                "id": "node_0010",
                "name": "N7LKS_SPS_B_01",
                "type": "MTP_LINKSET",
                "layer": 2,
                "parent": "node_0009",
                "x": 1.592040838891559e-14,
                "y": 260.0,
                "color": "#3498DB",
                "size": 18,
                "shape": "rect",
                "details": {
                        "Node Type": "MTP_LINKSET",
                        "Layer": 2,
                        "Entity Name": "M2PA_SPS_B_01",
                        "Network Indicator": "NM",
                        "Office Name": "Default local office"
                },
                "entity_name": "M2PA_SPS_B_01",
                "network_indicator": "NM",
                "office_name": "Default local office"
        },
        {
                "id": "node_0011",
                "name": "N7LNK_SPS_B_01\nLocal:1225 \u27f7 172.21.128.110:1225",
                "type": "MTP_LINK",
                "layer": 3,
                "parent": "node_0010",
                "x": -340.0,
                "y": 4.163799117101001e-14,
                "color": "#3498DB",
                "size": 12,
                "shape": "triangle",
                "details": {
                        "Node Type": "MTP_LINK",
                        "Layer": 3,
                        "Connection Type": "M2PA",
                        "Remote Ip": "172.21.128.110",
                        "Remote Port": "1225",
                        "Local Port": "1225",
                        "Connection": "Local:1225 \u27f7 172.21.128.110:1225",
                        "Signaling Link Code": "0"
                },
                "connection_type": "M2PA",
                "remote_ip": "172.21.128.110",
                "remote_port": "1225",
                "local_port": "1225",
                "connection": "Local:1225 \u27f7 172.21.128.110:1225",
                "signaling_link_code": "0"
        },
        {
                "id": "node_0012",
                "name": "N7LNK_SPS_B_02\nLocal:1226 \u27f7 172.21.128.110:1226",
                "type": "MTP_LINK",
                "layer": 3,
                "parent": "node_0010",
                "x": -319.4954910672089,
                "y": -116.28684873072734,
                "color": "#3498DB",
                "size": 12,
                "shape": "triangle",
                "details": {
                        "Node Type": "MTP_LINK",
                        "Layer": 3,
                        "Connection Type": "M2PA",
                        "Remote Ip": "172.21.128.110",
                        "Remote Port": "1226",
                        "Local Port": "1226",
                        "Connection": "Local:1226 \u27f7 172.21.128.110:1226",
                        "Signaling Link Code": "1"
                },
                "connection_type": "M2PA",
                "remote_ip": "172.21.128.110",
                "remote_port": "1226",
                "local_port": "1226",
                "connection": "Local:1226 \u27f7 172.21.128.110:1226",
                "signaling_link_code": "1"
        },
        {
                "id": "node_0013",
                "name": "M3UA_MSC_01",
                "type": "MTP_DSP",
                "layer": 1,
                "parent": null,
                "x": -127.27922061357854,
                "y": 127.27922061357856,
                "color": "#3498DB",
                "size": 25,
                "shape": "hexagon",
                "details": {
                        "Node Type": "MTP_DSP",
                        "Layer": 1,
                        "Point Code": "000804",
                        "Network": "default",
                        "Sua Point": "FALSE"
                },
                "point_code": "000804",
                "network": "default",
                "sua_point": "FALSE"
        },
        {
                "id": "node_0014",
                "name": "M3AS_MSC_01",
                "type": "M3UA_AS",
                "layer": 2,
                "parent": "node_0013",
                "x": -183.84776310850233,
                "y": 183.84776310850236,
                "color": "#27AE60",
                "size": 25,
                "shape": "diamond",
                "details": {
                        "Node Type": "M3UA_AS",
                        "Layer": 2,
                        "Point Code": "M3UA_MSC_01",
                        "Network": "NM",
                        "Dsp Reference": "M3UA_MSC_01"
                },
                "point_code": "M3UA_MSC_01",
                "network": "NM",
                "dsp_reference": "M3UA_MSC_01"
        },
        {
                "id": "node_0015",
                "name": "M3LKS_MSC_01",
                "type": "M3UA_LINKSET",
                "layer": 3,
                "parent": "node_0014",
                "x": -275.06577808748216,
                "y": -199.84698577944084,
                "color": "#27AE60",
                "size": 18,
                "shape": "rect",
                "details": {
                        "Node Type": "M3UA_LINKSET",
                        "Layer": 3,
                        "Entity Name": "M3AS_MSC_01",
                        "Office Name": "NULL"
                },
                "entity_name": "M3AS_MSC_01",
                "network_indicator": "",
                "office_name": "NULL"
        },
        {
                "id": "node_0016",
                "name": "M3LNK_MSC_01\nLocal:1025 \u27f7 172.21.1.10:1025",
                "type": "M3UA_LINK",
                "layer": 4,
                "parent": "node_0015",
                "x": 420.0,
                "y": 0.0,
                "color": "#27AE60",
                "size": 12,
                "shape": "triangle",
                "details": {
                        "Node Type": "M3UA_LINK",
                        "Layer": 4,
                        "Remote Ip": "172.21.1.10",
                        "Remote Port": "1025",
                        "Local Port": "1025",
                        "Connection": "Local:1025 \u27f7 172.21.1.10:1025",
                        "Media Id": "501"
                },
                "remote_ip": "172.21.1.10",
                "remote_port": "1025",
                "local_port": "1025",
                "connection": "Local:1025 \u27f7 172.21.1.10:1025",
                "media_id": "501"
        },
        {
                "id": "node_0017",
                "name": "M3LNK_MSC_02\nLocal:1026 \u27f7 172.21.1.10:1026",
                "type": "M3UA_LINK",
                "layer": 4,
                "parent": "node_0015",
                "x": 296.98484809834997,
                "y": 296.98484809834997,
                "color": "#27AE60",
                "size": 12,
                "shape": "triangle",
                "details": {
                        "Node Type": "M3UA_LINK",
                        "Layer": 4,
                        "Remote Ip": "172.21.1.10",
                        "Remote Port": "1026",
                        "Local Port": "1026",
                        "Connection": "Local:1026 \u27f7 172.21.1.10:1026",
                        "Media Id": "505"
                },
                "remote_ip": "172.21.1.10",
                "remote_port": "1026",
                "local_port": "1026",
                "connection": "Local:1026 \u27f7 172.21.1.10:1026",
                "media_id": "505"
        },
        {
                "id": "node_0018",
                "name": "M3UA_HLR_01",
                "type": "MTP_DSP",
                "layer": 1,
                "parent": null,
                "x": -180.0,
                "y": 2.2043642384652358e-14,
                "color": "#3498DB",
                "size": 25,
                "shape": "hexagon",
                "details": {
                        "Node Type": "MTP_DSP",
                        "Layer": 1,
                        "Point Code": "000805",
                        "Network": "default",
                        "Sua Point": "FALSE"
                },
                "point_code": "000805",
                "network": "default",
                "sua_point": "FALSE"
        },
        {
                "id": "node_0019",
                "name": "M3AS_HLR_01",
                "type": "M3UA_AS",
                "layer": 2,
                "parent": "node_0018",
                "x": -260.0,
                "y": 3.184081677783118e-14,
                "color": "#27AE60",
                "size": 25,
                "shape": "diamond",
                "details": {
                        "Node Type": "M3UA_AS",
                        "Layer": 2,
                        "Point Code": "M3UA_HLR_01",
                        "Network": "NM",
                        "Dsp Reference": "M3UA_HLR_01"
                },
                "point_code": "M3UA_HLR_01",
                "network": "NM",
                "dsp_reference": "M3UA_HLR_01"
        },
        {
                "id": "node_0020",
                "name": "M3LKS_HLR_01",
                "type": "M3UA_LINKSET",
                "layer": 3,
                "parent": "node_0019",
                "x": -222.65264954139698,
                "y": -256.95485528044776,
                "color": "#27AE60",
                "size": 18,
                "shape": "rect",
                "details": {
                        "Node Type": "M3UA_LINKSET",
                        "Layer": 3,
                        "Entity Name": "M3AS_HLR_01",
                        "Office Name": "NULL"
                },
                "entity_name": "M3AS_HLR_01",
                "network_indicator": "",
                "office_name": "NULL"
        },
        {
                "id": "node_0021",
                "name": "M3LNK_HLR_01\nLocal:1125 \u27f7 172.21.129.100:1125",
                "type": "M3UA_LINK",
                "layer": 4,
                "parent": "node_0020",
                "x": 2.5717582782094416e-14,
                "y": 420.0,
                "color": "#27AE60",
                "size": 12,
                "shape": "triangle",
                "details": {
                        "Node Type": "M3UA_LINK",
                        "Layer": 4,
                        "Remote Ip": "172.21.129.100",
                        "Remote Port": "1125",
                        "Local Port": "1125",
                        "Connection": "Local:1125 \u27f7 172.21.129.100:1125",
                        "Media Id": "502"
                },
                "remote_ip": "172.21.129.100",
                "remote_port": "1125",
                "local_port": "1125",
                "connection": "Local:1125 \u27f7 172.21.129.100:1125",
                "media_id": "502"
        },
        {
                "id": "node_0022",
                "name": "M3LNK_HLR_02\nLocal:1126 \u27f7 172.21.129.100:1126",
                "type": "M3UA_LINK",
                "layer": 4,
                "parent": "node_0020",
                "x": -296.9848480983499,
                "y": 296.98484809834997,
                "color": "#27AE60",
                "size": 12,
                "shape": "triangle",
                "details": {
                        "Node Type": "M3UA_LINK",
                        "Layer": 4,
                        "Remote Ip": "172.21.129.100",
                        "Remote Port": "1126",
                        "Local Port": "1126",
                        "Connection": "Local:1126 \u27f7 172.21.129.100:1126",
                        "Media Id": "506"
                },
                "remote_ip": "172.21.129.100",
                "remote_port": "1126",
                "local_port": "1126",
                "connection": "Local:1126 \u27f7 172.21.129.100:1126",
                "media_id": "506"
        },
        {
                "id": "node_0023",
                "name": "SG1",
                "type": "M2UA_SG",
                "layer": 1,
                "parent": null,
                "x": -169.14467174146353,
                "y": -61.56362579862036,
                "color": "#F39C12",
                "size": 25,
                "shape": "diamond",
                "details": {
                        "Node Type": "M2UA_SG",
                        "Layer": 1,
                        "Sg Name": "SG1",
                        "Description": "M2UA Signal Gateway"
                },
                "sg_name": "SG1",
                "description": "M2UA Signal Gateway"
        },
        {
                "id": "node_0024",
                "name": "M2LKS_01",
                "type": "M2UA_LINKSET",
                "layer": 2,
                "parent": "node_0023",
                "x": -244.32008140433618,
                "y": -88.92523726467385,
                "color": "#F39C12",
                "size": 18,
                "shape": "rect",
                "details": {
                        "Node Type": "M2UA_LINKSET",
                        "Layer": 2,
                        "Sg Name": "SG1",
                        "Max Number": "6",
                        "Description": "M2UA Link Set"
                },
                "sg_name": "SG1",
                "max_number": "6",
                "description": "M2UA Link Set"
        },
        {
                "id": "node_0025",
                "name": "M2LNK_01\nIPADDR1:5000 \u27f7 172.25.8.9:5000",
                "type": "M2UA_LINK",
                "layer": 3,
                "parent": "node_0024",
                "x": -170.00000000000014,
                "y": -294.4486372867091,
                "color": "#F39C12",
                "size": 12,
                "shape": "triangle",
                "details": {
                        "Node Type": "M2UA_LINK",
                        "Layer": 3,
                        "Ip Transport Protocol": "IPv4",
                        "Local Ip": "IPADDR1",
                        "Local Port": "5000",
                        "Peer Ip": "172.25.8.9",
                        "Peer Port": "5000",
                        "Active Standby": "ACTIVE",
                        "Sctp Param Name": "Default",
                        "Connection": "IPADDR1:5000 \u27f7 172.25.8.9:5000"
                },
                "ip_transport_protocol": "IPv4",
                "local_ip": "IPADDR1",
                "local_port": "5000",
                "peer_ip": "172.25.8.9",
                "peer_port": "5000",
                "active_standby": "ACTIVE",
                "sctp_param_name": "Default",
                "connection": "IPADDR1:5000 \u27f7 172.25.8.9:5000"
        },
        {
                "id": "node_0026",
                "name": "SPS_B",
                "type": "DIAMETER_PEER",
                "layer": 1,
                "parent": null,
                "x": -145.62305898749054,
                "y": -105.80134541264515,
                "color": "#E74C3C",
                "size": 25,
                "shape": "circle",
                "details": {
                        "Node Type": "DIAMETER_PEER",
                        "Layer": 1,
                        "Hostname": "SPSB.huawei.com",
                        "Realm": "huawei.com",
                        "Interface": "S6a/S6d-1&Relay-1",
                        "Protocol Type": "DIAMETER"
                },
                "hostname": "SPSB.huawei.com",
                "realm": "huawei.com",
                "interface": "S6a/S6d-1&Relay-1",
                "protocol_type": "DIAMETER",
                "host_ip": "",
                "port": ""
        },
        {
                "id": "node_0027",
                "name": "SPS_A_SPS_B_DMLKS01",
                "type": "DIAMETER_LINKSET",
                "layer": 2,
                "parent": "node_0026",
                "x": -210.34441853748635,
                "y": -152.82416559604297,
                "color": "#E74C3C",
                "size": 18,
                "shape": "rect",
                "details": {
                        "Node Type": "DIAMETER_LINKSET",
                        "Layer": 2,
                        "Peer Name": "SPS_B",
                        "Da Name": "SPS_A"
                },
                "peer_name": "SPS_B",
                "da_name": "SPS_A",
                "load_sharing_mode": ""
        },
        {
                "id": "node_0028",
                "name": "SPS_A_SPS_B_DMLNK01\nLocal:5001 \u27f7 172.21.1.103:5001",
                "type": "DIAMETER_LINK",
                "layer": 3,
                "parent": "node_0027",
                "x": -120.5656615944622,
                "y": -317.905522513041,
                "color": "#E74C3C",
                "size": 12,
                "shape": "triangle",
                "details": {
                        "Node Type": "DIAMETER_LINK",
                        "Layer": 3,
                        "Mid": "501",
                        "Protocol Type": "SCTP",
                        "Working Mode": "SERVER",
                        "Peer Ip": "172.21.1.103",
                        "Peer Port": "5001",
                        "Local Port": "5001",
                        "Connection": "Local:5001 \u27f7 172.21.1.103:5001"
                },
                "mid": "501",
                "protocol_type": "SCTP",
                "working_mode": "SERVER",
                "peer_ip": "172.21.1.103",
                "peer_port": "5001",
                "local_port": "5001",
                "connection": "Local:5001 \u27f7 172.21.1.103:5001"
        },
        {
                "id": "node_0029",
                "name": "SPS_A_SPS_B_DMLNK02\nLocal:5002 \u27f7 172.21.1.103:5002",
                "type": "DIAMETER_LINK",
                "layer": 3,
                "parent": "node_0027",
                "x": -75.65711754514696,
                "y": -331.47549014182005,
                "color": "#E74C3C",
                "size": 12,
                "shape": "triangle",
                "details": {
                        "Node Type": "DIAMETER_LINK",
                        "Layer": 3,
                        "Mid": "505",
                        "Protocol Type": "SCTP",
                        "Working Mode": "SERVER",
                        "Peer Ip": "172.21.1.103",
                        "Peer Port": "5002",
                        "Local Port": "5002",
                        "Connection": "Local:5002 \u27f7 172.21.1.103:5002"
                },
                "mid": "505",
                "protocol_type": "SCTP",
                "working_mode": "SERVER",
                "peer_ip": "172.21.1.103",
                "peer_port": "5002",
                "local_port": "5002",
                "connection": "Local:5002 \u27f7 172.21.1.103:5002"
        },
        {
                "id": "node_0030",
                "name": "MME",
                "type": "DIAMETER_PEER",
                "layer": 1,
                "parent": null,
                "x": -117.87493211015133,
                "y": -136.03492338376645,
                "color": "#E74C3C",
                "size": 25,
                "shape": "circle",
                "details": {
                        "Node Type": "DIAMETER_PEER",
                        "Layer": 1,
                        "Hostname": "mme.huawei.com",
                        "Realm": "huawei.com",
                        "Interface": "S6a/S6d-1",
                        "Protocol Type": "DIAMETER"
                },
                "hostname": "mme.huawei.com",
                "realm": "huawei.com",
                "interface": "S6a/S6d-1",
                "protocol_type": "DIAMETER",
                "host_ip": "",
                "port": ""
        },
        {
                "id": "node_0031",
                "name": "HSS",
                "type": "DIAMETER_PEER",
                "layer": 1,
                "parent": null,
                "x": -90.00000000000009,
                "y": -155.88457268119893,
                "color": "#E74C3C",
                "size": 25,
                "shape": "circle",
                "details": {
                        "Node Type": "DIAMETER_PEER",
                        "Layer": 1,
                        "Hostname": "hss.huawei.com",
                        "Realm": "huawei.com",
                        "Interface": "S6a/S6d-1",
                        "Protocol Type": "DIAMETER"
                },
                "hostname": "hss.huawei.com",
                "realm": "huawei.com",
                "interface": "S6a/S6d-1",
                "protocol_type": "DIAMETER",
                "host_ip": "",
                "port": ""
        },
        {
                "id": "node_0032",
                "name": "SPS_A_MME_DMLKS01",
                "type": "DIAMETER_LINKSET",
                "layer": 2,
                "parent": "node_0030",
                "x": -170.26379082577415,
                "y": -196.4948893321071,
                "color": "#E74C3C",
                "size": 18,
                "shape": "rect",
                "details": {
                        "Node Type": "DIAMETER_LINKSET",
                        "Layer": 2,
                        "Peer Name": "MME",
                        "Da Name": "SPS_A",
                        "Load Sharing Mode": "ROUND-ROBIN"
                },
                "peer_name": "MME",
                "da_name": "SPS_A",
                "load_sharing_mode": "ROUND-ROBIN"
        },
        {
                "id": "node_0033",
                "name": "SPS_A_HSS_DMLKS01",
                "type": "DIAMETER_LINKSET",
                "layer": 2,
                "parent": "node_0031",
                "x": -130.0000000000001,
                "y": -225.16660498395402,
                "color": "#E74C3C",
                "size": 18,
                "shape": "rect",
                "details": {
                        "Node Type": "DIAMETER_LINKSET",
                        "Layer": 2,
                        "Peer Name": "HSS",
                        "Da Name": "SPS_A",
                        "Load Sharing Mode": "ROUND-ROBIN"
                },
                "peer_name": "HSS",
                "da_name": "SPS_A",
                "load_sharing_mode": "ROUND-ROBIN"
        },
        {
                "id": "node_0034",
                "name": "SPS_A_MME_DMLNK01\nLocal:5005 \u27f7 172.21.1.101:5005",
                "type": "DIAMETER_LINK",
                "layer": 3,
                "parent": "node_0032",
                "x": -35.53967751100244,
                "y": -338.1374444252129,
                "color": "#E74C3C",
                "size": 12,
                "shape": "triangle",
                "details": {
                        "Node Type": "DIAMETER_LINK",
                        "Layer": 3,
                        "Mid": "502",
                        "Protocol Type": "SCTP",
                        "Working Mode": "SERVER",
                        "Peer Ip": "172.21.1.101",
                        "Peer Port": "5005",
                        "Local Port": "5005",
                        "Connection": "Local:5005 \u27f7 172.21.1.101:5005"
                },
                "mid": "502",
                "protocol_type": "SCTP",
                "working_mode": "SERVER",
                "peer_ip": "172.21.1.101",
                "peer_port": "5005",
                "local_port": "5005",
                "connection": "Local:5005 \u27f7 172.21.1.101:5005"
        },
        {
                "id": "node_0035",
                "name": "SPS_A_HSS_DMLNK01\nLocal:5006 \u27f7 172.21.1.102:5006",
                "type": "DIAMETER_LINK",
                "layer": 3,
                "parent": "node_0033",
                "x": -6.245698675651501e-14,
                "y": -340.0,
                "color": "#E74C3C",
                "size": 12,
                "shape": "triangle",
                "details": {
                        "Node Type": "DIAMETER_LINK",
                        "Layer": 3,
                        "Mid": "503",
                        "Protocol Type": "SCTP",
                        "Working Mode": "SERVER",
                        "Peer Ip": "172.21.1.102",
                        "Peer Port": "5006",
                        "Local Port": "5006",
                        "Connection": "Local:5006 \u27f7 172.21.1.102:5006"
                },
                "mid": "503",
                "protocol_type": "SCTP",
                "working_mode": "SERVER",
                "peer_ip": "172.21.1.102",
                "peer_port": "5006",
                "local_port": "5006",
                "connection": "Local:5006 \u27f7 172.21.1.102:5006"
        },
        {
                "id": "node_0036",
                "name": "SPS_A_MME_DMLNK02\nLocal:5007 \u27f7 172.21.1.101:5007",
                "type": "DIAMETER_LINK",
                "layer": 3,
                "parent": "node_0032",
                "x": 31.371242217522827,
                "y": -338.54961994031174,
                "color": "#E74C3C",
                "size": 12,
                "shape": "triangle",
                "details": {
                        "Node Type": "DIAMETER_LINK",
                        "Layer": 3,
                        "Mid": "506",
                        "Protocol Type": "SCTP",
                        "Working Mode": "SERVER",
                        "Peer Ip": "172.21.1.101",
                        "Peer Port": "5007",
                        "Local Port": "5007",
                        "Connection": "Local:5007 \u27f7 172.21.1.101:5007"
                },
                "mid": "506",
                "protocol_type": "SCTP",
                "working_mode": "SERVER",
                "peer_ip": "172.21.1.101",
                "peer_port": "5007",
                "local_port": "5007",
                "connection": "Local:5007 \u27f7 172.21.1.101:5007"
        },
        {
                "id": "node_0037",
                "name": "SPS_A_HSS_DMLNK02\nLocal:5008 \u27f7 172.21.1.102:5008",
                "type": "DIAMETER_LINK",
                "layer": 3,
                "parent": "node_0033",
                "x": 59.04038040675619,
                "y": -334.83463602415077,
                "color": "#E74C3C",
                "size": 12,
                "shape": "triangle",
                "details": {
                        "Node Type": "DIAMETER_LINK",
                        "Layer": 3,
                        "Mid": "507",
                        "Protocol Type": "SCTP",
                        "Working Mode": "SERVER",
                        "Peer Ip": "172.21.1.102",
                        "Peer Port": "5008",
                        "Local Port": "5008",
                        "Connection": "Local:5008 \u27f7 172.21.1.102:5008"
                },
                "mid": "507",
                "protocol_type": "SCTP",
                "working_mode": "SERVER",
                "peer_ip": "172.21.1.102",
                "peer_port": "5008",
                "local_port": "5008",
                "connection": "Local:5008 \u27f7 172.21.1.102:5008"
        },
        {
                "id": "node_0038",
                "name": "M2PA_SPS_B_01",
                "type": "MTP_DSP",
                "layer": 1,
                "parent": null,
                "x": -63.82887966765646,
                "y": -168.30292368337464,
                "color": "#3498DB",
                "size": 25,
                "shape": "hexagon",
                "details": {
                        "Node Type": "MTP_DSP",
                        "Layer": 1,
                        "Point Code": "000806",
                        "Network": "default",
                        "Sua Point": "FALSE"
                },
                "point_code": "000806",
                "network": "default",
                "sua_point": "FALSE"
        },
        {
                "id": "node_0039",
                "name": "N7LKS_SPS_B_01",
                "type": "MTP_LINKSET",
                "layer": 2,
                "parent": "node_0038",
                "x": -92.19727063105934,
                "y": -243.10422309820783,
                "color": "#3498DB",
                "size": 18,
                "shape": "rect",
                "details": {
                        "Node Type": "MTP_LINKSET",
                        "Layer": 2,
                        "Entity Name": "M2PA_SPS_B_01",
                        "Network Indicator": "NM",
                        "Office Name": "Default local office"
                },
                "entity_name": "M2PA_SPS_B_01",
                "network_indicator": "NM",
                "office_name": "Default local office"
        },
        {
                "id": "node_0040",
                "name": "N7LNK_SPS_B_01\nLocal:1225 \u27f7 172.21.128.110:1225",
                "type": "MTP_LINK",
                "layer": 3,
                "parent": "node_0039",
                "x": 83.4650656278716,
                "y": -329.5960904193724,
                "color": "#3498DB",
                "size": 12,
                "shape": "triangle",
                "details": {
                        "Node Type": "MTP_LINK",
                        "Layer": 3,
                        "Connection Type": "M2PA",
                        "Remote Ip": "172.21.128.110",
                        "Remote Port": "1225",
                        "Local Port": "1225",
                        "Connection": "Local:1225 \u27f7 172.21.128.110:1225",
                        "Signaling Link Code": "0"
                },
                "connection_type": "M2PA",
                "remote_ip": "172.21.128.110",
                "remote_port": "1225",
                "local_port": "1225",
                "connection": "Local:1225 \u27f7 172.21.128.110:1225",
                "signaling_link_code": "0"
        },
        {
                "id": "node_0041",
                "name": "N7LNK_SPS_B_02\nLocal:1226 \u27f7 172.21.128.110:1226",
                "type": "MTP_LINK",
                "layer": 3,
                "parent": "node_0039",
                "x": 105.06577808748206,
                "y": -323.35921554035224,
                "color": "#3498DB",
                "size": 12,
                "shape": "triangle",
                "details": {
                        "Node Type": "MTP_LINK",
                        "Layer": 3,
                        "Connection Type": "M2PA",
                        "Remote Ip": "172.21.128.110",
                        "Remote Port": "1226",
                        "Local Port": "1226",
                        "Connection": "Local:1226 \u27f7 172.21.128.110:1226",
                        "Signaling Link Code": "1"
                },
                "connection_type": "M2PA",
                "remote_ip": "172.21.128.110",
                "remote_port": "1226",
                "local_port": "1226",
                "connection": "Local:1226 \u27f7 172.21.128.110:1226",
                "signaling_link_code": "1"
        },
        {
                "id": "node_0042",
                "name": "M3UA_MSC_01",
                "type": "MTP_DSP",
                "layer": 1,
                "parent": null,
                "x": -40.05376811213662,
                "y": -175.48702419272826,
                "color": "#3498DB",
                "size": 25,
                "shape": "hexagon",
                "details": {
                        "Node Type": "MTP_DSP",
                        "Layer": 1,
                        "Point Code": "000804",
                        "Network": "default",
                        "Sua Point": "FALSE"
                },
                "point_code": "000804",
                "network": "default",
                "sua_point": "FALSE"
        },
        {
                "id": "node_0043",
                "name": "M3AS_MSC_01",
                "type": "M3UA_AS",
                "layer": 2,
                "parent": "node_0042",
                "x": -57.85544282864179,
                "y": -253.48125716727415,
                "color": "#27AE60",
                "size": 25,
                "shape": "diamond",
                "details": {
                        "Node Type": "M3UA_AS",
                        "Layer": 2,
                        "Point Code": "M3UA_MSC_01",
                        "Network": "NM",
                        "Dsp Reference": "M3UA_MSC_01"
                },
                "point_code": "M3UA_MSC_01",
                "network": "NM",
                "dsp_reference": "M3UA_MSC_01"
        },
        {
                "id": "node_0044",
                "name": "M3LKS_MSC_01",
                "type": "M3UA_LINKSET",
                "layer": 3,
                "parent": "node_0043",
                "x": 124.21594828457442,
                "y": -316.4970745390294,
                "color": "#27AE60",
                "size": 18,
                "shape": "rect",
                "details": {
                        "Node Type": "M3UA_LINKSET",
                        "Layer": 3,
                        "Entity Name": "M3AS_MSC_01",
                        "Office Name": "NULL"
                },
                "entity_name": "M3AS_MSC_01",
                "network_indicator": "",
                "office_name": "NULL"
        },
        {
                "id": "node_0045",
                "name": "M3LNK_MSC_01\nLocal:1025 \u27f7 172.21.1.10:1025",
                "type": "M3UA_LINK",
                "layer": 4,
                "parent": "node_0044",
                "x": -420.0,
                "y": 5.143516556418883e-14,
                "color": "#27AE60",
                "size": 12,
                "shape": "triangle",
                "details": {
                        "Node Type": "M3UA_LINK",
                        "Layer": 4,
                        "Remote Ip": "172.21.1.10",
                        "Remote Port": "1025",
                        "Local Port": "1025",
                        "Connection": "Local:1025 \u27f7 172.21.1.10:1025",
                        "Media Id": "501"
                },
                "remote_ip": "172.21.1.10",
                "remote_port": "1025",
                "local_port": "1025",
                "connection": "Local:1025 \u27f7 172.21.1.10:1025",
                "media_id": "501"
        },
        {
                "id": "node_0046",
                "name": "M3LNK_MSC_02\nLocal:1026 \u27f7 172.21.1.10:1026",
                "type": "M3UA_LINK",
                "layer": 4,
                "parent": "node_0044",
                "x": -394.67090073008154,
                "y": -143.64846019678083,
                "color": "#27AE60",
                "size": 12,
                "shape": "triangle",
                "details": {
                        "Node Type": "M3UA_LINK",
                        "Layer": 4,
                        "Remote Ip": "172.21.1.10",
                        "Remote Port": "1026",
                        "Local Port": "1026",
                        "Connection": "Local:1026 \u27f7 172.21.1.10:1026",
                        "Media Id": "505"
                },
                "remote_ip": "172.21.1.10",
                "remote_port": "1026",
                "local_port": "1026",
                "connection": "Local:1026 \u27f7 172.21.1.10:1026",
                "media_id": "505"
        },
        {
                "id": "node_0047",
                "name": "M3UA_HLR_01",
                "type": "MTP_DSP",
                "layer": 1,
                "parent": null,
                "x": -18.815123388177764,
                "y": -179.0139411662892,
                "color": "#3498DB",
                "size": 25,
                "shape": "hexagon",
                "details": {
                        "Node Type": "MTP_DSP",
                        "Layer": 1,
                        "Point Code": "000805",
                        "Network": "default",
                        "Sua Point": "FALSE"
                },
                "point_code": "000805",
                "network": "default",
                "sua_point": "FALSE"
        },
        {
                "id": "node_0048",
                "name": "M3AS_HLR_01",
                "type": "M3UA_AS",
                "layer": 2,
                "parent": "node_0047",
                "x": -27.177400449590102,
                "y": -258.5756927957511,
                "color": "#27AE60",
                "size": 25,
                "shape": "diamond",
                "details": {
                        "Node Type": "M3UA_AS",
                        "Layer": 2,
                        "Point Code": "M3UA_HLR_01",
                        "Network": "NM",
                        "Dsp Reference": "M3UA_HLR_01"
                },
                "point_code": "M3UA_HLR_01",
                "network": "NM",
                "dsp_reference": "M3UA_HLR_01"
        },
        {
                "id": "node_0049",
                "name": "M3LKS_HLR_01",
                "type": "M3UA_LINKSET",
                "layer": 3,
                "parent": "node_0048",
                "x": 141.24110442064125,
                "y": -309.2748784205363,
                "color": "#27AE60",
                "size": 18,
                "shape": "rect",
                "details": {
                        "Node Type": "M3UA_LINKSET",
                        "Layer": 3,
                        "Entity Name": "M3AS_HLR_01",
                        "Office Name": "NULL"
                },
                "entity_name": "M3AS_HLR_01",
                "network_indicator": "",
                "office_name": "NULL"
        },
        {
                "id": "node_0050",
                "name": "M3LNK_HLR_01\nLocal:1125 \u27f7 172.21.129.100:1125",
                "type": "M3UA_LINK",
                "layer": 4,
                "parent": "node_0049",
                "x": -339.78713763747794,
                "y": -246.86980596283868,
                "color": "#27AE60",
                "size": 12,
                "shape": "triangle",
                "details": {
                        "Node Type": "M3UA_LINK",
                        "Layer": 4,
                        "Remote Ip": "172.21.129.100",
                        "Remote Port": "1125",
                        "Local Port": "1125",
                        "Connection": "Local:1125 \u27f7 172.21.129.100:1125",
                        "Media Id": "502"
                },
                "remote_ip": "172.21.129.100",
                "remote_port": "1125",
                "local_port": "1125",
                "connection": "Local:1125 \u27f7 172.21.129.100:1125",
                "media_id": "502"
        },
        {
                "id": "node_0051",
                "name": "M3LNK_HLR_02\nLocal:1126 \u27f7 172.21.129.100:1126",
                "type": "M3UA_LINK",
                "layer": 4,
                "parent": "node_0049",
                "x": -275.0415082570198,
                "y": -317.4148212287884,
                "color": "#27AE60",
                "size": 12,
                "shape": "triangle",
                "details": {
                        "Node Type": "M3UA_LINK",
                        "Layer": 4,
                        "Remote Ip": "172.21.129.100",
                        "Remote Port": "1126",
                        "Local Port": "1126",
                        "Connection": "Local:1126 \u27f7 172.21.129.100:1126",
                        "Media Id": "506"
                },
                "remote_ip": "172.21.129.100",
                "remote_port": "1126",
                "local_port": "1126",
                "connection": "Local:1126 \u27f7 172.21.129.100:1126",
                "media_id": "506"
        },
        {
                "id": "node_0052",
                "name": "SPS_B",
                "type": "DIAMETER_PEER",
                "layer": 1,
                "parent": null,
                "x": -3.3065463576978534e-14,
                "y": -180.0,
                "color": "#E74C3C",
                "size": 25,
                "shape": "circle",
                "details": {
                        "Node Type": "DIAMETER_PEER",
                        "Layer": 1,
                        "Hostname": "spsB.huawei.com",
                        "Realm": "huawei.com",
                        "Interface": "S6a/S6d-1&Relay-1",
                        "Protocol Type": "DIAMETER"
                },
                "hostname": "spsB.huawei.com",
                "realm": "huawei.com",
                "interface": "S6a/S6d-1&Relay-1",
                "protocol_type": "DIAMETER",
                "host_ip": "",
                "port": ""
        },
        {
                "id": "node_0053",
                "name": "SPS_A_SPS_B_DMLKS01",
                "type": "DIAMETER_LINKSET",
                "layer": 2,
                "parent": "node_0052",
                "x": -4.776122516674677e-14,
                "y": -260.0,
                "color": "#E74C3C",
                "size": 18,
                "shape": "rect",
                "details": {
                        "Node Type": "DIAMETER_LINKSET",
                        "Layer": 2,
                        "Peer Name": "SPS_B",
                        "Da Name": "SPS_A"
                },
                "peer_name": "SPS_B",
                "da_name": "SPS_A",
                "load_sharing_mode": ""
        },
        {
                "id": "node_0054",
                "name": "SPS_A_SPS_B_DMLNK01\nLocal:5001 \u27f7 172.21.128.103:5001",
                "type": "DIAMETER_LINK",
                "layer": 3,
                "parent": "node_0053",
                "x": 156.42211282859154,
                "y": -301.8809742568077,
                "color": "#E74C3C",
                "size": 12,
                "shape": "triangle",
                "details": {
                        "Node Type": "DIAMETER_LINK",
                        "Layer": 3,
                        "Mid": "501",
                        "Protocol Type": "SCTP",
                        "Working Mode": "SERVER",
                        "Peer Ip": "172.21.128.103",
                        "Peer Port": "5001",
                        "Local Port": "5001",
                        "Connection": "Local:5001 \u27f7 172.21.128.103:5001"
                },
                "mid": "501",
                "protocol_type": "SCTP",
                "working_mode": "SERVER",
                "peer_ip": "172.21.128.103",
                "peer_port": "5001",
                "local_port": "5001",
                "connection": "Local:5001 \u27f7 172.21.128.103:5001"
        },
        {
                "id": "node_0055",
                "name": "SPS_A_SPS_B_DMLNK02\nLocal:5002 \u27f7 172.21.128.103:5002",
                "type": "DIAMETER_LINK",
                "layer": 3,
                "parent": "node_0053",
                "x": 170.00000000000003,
                "y": -294.44863728670913,
                "color": "#E74C3C",
                "size": 12,
                "shape": "triangle",
                "details": {
                        "Node Type": "DIAMETER_LINK",
                        "Layer": 3,
                        "Mid": "505",
                        "Protocol Type": "SCTP",
                        "Working Mode": "SERVER",
                        "Peer Ip": "172.21.128.103",
                        "Peer Port": "5002",
                        "Local Port": "5002",
                        "Connection": "Local:5002 \u27f7 172.21.128.103:5002"
                },
                "mid": "505",
                "protocol_type": "SCTP",
                "working_mode": "SERVER",
                "peer_ip": "172.21.128.103",
                "peer_port": "5002",
                "local_port": "5002",
                "connection": "Local:5002 \u27f7 172.21.128.103:5002"
        },
        {
                "id": "node_0056",
                "name": "SPS_A_SPS_B_N7DSP01",
                "type": "MTP_DSP",
                "layer": 1,
                "parent": null,
                "x": 16.608304703394438,
                "y": -179.2321517331062,
                "color": "#3498DB",
                "size": 25,
                "shape": "hexagon",
                "details": {
                        "Node Type": "MTP_DSP",
                        "Layer": 1,
                        "Point Code": "000300",
                        "Network": "default",
                        "Sua Point": "FALSE"
                },
                "point_code": "000300",
                "network": "default",
                "sua_point": "FALSE"
        },
        {
                "id": "node_0057",
                "name": "SPS_A_SPS_B_N7LKS01",
                "type": "MTP_LINKSET",
                "layer": 2,
                "parent": "node_0056",
                "x": 23.989773460458633,
                "y": -258.89088583670895,
                "color": "#3498DB",
                "size": 18,
                "shape": "rect",
                "details": {
                        "Node Type": "MTP_LINKSET",
                        "Layer": 2,
                        "Entity Name": "SPS_A_SPS_B_N7DSP01",
                        "Network Indicator": "NM",
                        "Office Name": "Default local office"
                },
                "entity_name": "SPS_A_SPS_B_N7DSP01",
                "network_indicator": "NM",
                "office_name": "Default local office"
        },
        {
                "id": "node_0058",
                "name": "SPS_A_SPS_B_N7LNK01\nLocal:5003 \u27f7 172.21.128.103:5003",
                "type": "MTP_LINK",
                "layer": 3,
                "parent": "node_0057",
                "x": 182.1811102928589,
                "y": -287.07149467068507,
                "color": "#3498DB",
                "size": 12,
                "shape": "triangle",
                "details": {
                        "Node Type": "MTP_LINK",
                        "Layer": 3,
                        "Connection Type": "M2PA",
                        "Remote Ip": "172.21.128.103",
                        "Remote Port": "5003",
                        "Local Port": "5003",
                        "Connection": "Local:5003 \u27f7 172.21.128.103:5003",
                        "Signaling Link Code": "0"
                },
                "connection_type": "M2PA",
                "remote_ip": "172.21.128.103",
                "remote_port": "5003",
                "local_port": "5003",
                "connection": "Local:5003 \u27f7 172.21.128.103:5003",
                "signaling_link_code": "0"
        },
        {
                "id": "node_0059",
                "name": "SPS_A_SPS_B_N7LNK02\nLocal:5004 \u27f7 172.21.128.103:5004",
                "type": "MTP_LINK",
                "layer": 3,
                "parent": "node_0057",
                "x": 193.14201388859263,
                "y": -279.81451440384336,
                "color": "#3498DB",
                "size": 12,
                "shape": "triangle",
                "details": {
                        "Node Type": "MTP_LINK",
                        "Layer": 3,
                        "Connection Type": "M2PA",
                        "Remote Ip": "172.21.128.103",
                        "Remote Port": "5004",
                        "Local Port": "5004",
                        "Connection": "Local:5004 \u27f7 172.21.128.103:5004",
                        "Signaling Link Code": "1"
                },
                "connection_type": "M2PA",
                "remote_ip": "172.21.128.103",
                "remote_port": "5004",
                "local_port": "5004",
                "connection": "Local:5004 \u27f7 172.21.128.103:5004",
                "signaling_link_code": "1"
        },
        {
                "id": "node_0060",
                "name": "MME",
                "type": "DIAMETER_PEER",
                "layer": 1,
                "parent": null,
                "x": 31.256671980047393,
                "y": -177.26539554219747,
                "color": "#E74C3C",
                "size": 25,
                "shape": "circle",
                "details": {
                        "Node Type": "DIAMETER_PEER",
                        "Layer": 1,
                        "Hostname": "mme.huawei.com",
                        "Realm": "huawei.com",
                        "Interface": "S6a/S6d-1",
                        "Protocol Type": "DIAMETER"
                },
                "hostname": "mme.huawei.com",
                "realm": "huawei.com",
                "interface": "S6a/S6d-1",
                "protocol_type": "DIAMETER",
                "host_ip": "",
                "port": ""
        },
        {
                "id": "node_0061",
                "name": "HSS",
                "type": "DIAMETER_PEER",
                "layer": 1,
                "parent": null,
                "x": 44.18738768534378,
                "y": -174.4920478690795,
                "color": "#E74C3C",
                "size": 25,
                "shape": "circle",
                "details": {
                        "Node Type": "DIAMETER_PEER",
                        "Layer": 1,
                        "Hostname": "hss.huawei.com",
                        "Realm": "huawei.com",
                        "Interface": "S6a/S6d-1",
                        "Protocol Type": "DIAMETER"
                },
                "hostname": "hss.huawei.com",
                "realm": "huawei.com",
                "interface": "S6a/S6d-1",
                "protocol_type": "DIAMETER",
                "host_ip": "",
                "port": ""
        },
        {
                "id": "node_0062",
                "name": "SPS_A_MME_DMLKS01",
                "type": "DIAMETER_LINKSET",
                "layer": 2,
                "parent": "node_0060",
                "x": 45.14852619340179,
                "y": -256.0500157831741,
                "color": "#E74C3C",
                "size": 18,
                "shape": "rect",
                "details": {
                        "Node Type": "DIAMETER_LINKSET",
                        "Layer": 2,
                        "Peer Name": "MME",
                        "Da Name": "SPS_A"
                },
                "peer_name": "MME",
                "da_name": "SPS_A",
                "load_sharing_mode": ""
        },
        {
                "id": "node_0063",
                "name": "SPS_A_HSS_DMLKS01",
                "type": "DIAMETER_LINKSET",
                "layer": 2,
                "parent": "node_0061",
                "x": 63.82622665660769,
                "y": -252.04406914422592,
                "color": "#E74C3C",
                "size": 18,
                "shape": "rect",
                "details": {
                        "Node Type": "DIAMETER_LINKSET",
                        "Layer": 2,
                        "Peer Name": "HSS",
                        "Da Name": "SPS_A"
                },
                "peer_name": "HSS",
                "da_name": "SPS_A",
                "load_sharing_mode": ""
        },
        {
                "id": "node_0064",
                "name": "SPS_A_MME_DMLNK01\nLocal:5005 \u27f7 172.21.128.101:5005",
                "type": "DIAMETER_LINK",
                "layer": 3,
                "parent": "node_0062",
                "x": 203.0339211789472,
                "y": -272.7218855367149,
                "color": "#E74C3C",
                "size": 12,
                "shape": "triangle",
                "details": {
                        "Node Type": "DIAMETER_LINK",
                        "Layer": 3,
                        "Mid": "502",
                        "Protocol Type": "SCTP",
                        "Working Mode": "SERVER",
                        "Peer Ip": "172.21.128.101",
                        "Peer Port": "5005",
                        "Local Port": "5005",
                        "Connection": "Local:5005 \u27f7 172.21.128.101:5005"
                },
                "mid": "502",
                "protocol_type": "SCTP",
                "working_mode": "SERVER",
                "peer_ip": "172.21.128.101",
                "peer_port": "5005",
                "local_port": "5005",
                "connection": "Local:5005 \u27f7 172.21.128.101:5005"
        },
        {
                "id": "node_0065",
                "name": "SPS_A_MME_DMLNK02\nLocal:5006 \u27f7 172.21.128.101:5006",
                "type": "DIAMETER_LINK",
                "layer": 3,
                "parent": "node_0062",
                "x": 211.98653263196934,
                "y": -265.82270403913014,
                "color": "#E74C3C",
                "size": 12,
                "shape": "triangle",
                "details": {
                        "Node Type": "DIAMETER_LINK",
                        "Layer": 3,
                        "Mid": "503",
                        "Protocol Type": "SCTP",
                        "Working Mode": "SERVER",
                        "Peer Ip": "172.21.128.101",
                        "Peer Port": "5006",
                        "Local Port": "5006",
                        "Connection": "Local:5006 \u27f7 172.21.128.101:5006"
                },
                "mid": "503",
                "protocol_type": "SCTP",
                "working_mode": "SERVER",
                "peer_ip": "172.21.128.101",
                "peer_port": "5006",
                "local_port": "5006",
                "connection": "Local:5006 \u27f7 172.21.128.101:5006"
        },
        {
                "id": "node_0066",
                "name": "SPS_A_MME_DMLNK03\nLocal:5007 \u27f7 172.21.128.101:5007",
                "type": "DIAMETER_LINK",
                "layer": 3,
                "parent": "node_0062",
                "x": 220.1113368258215,
                "y": -259.1350987433963,
                "color": "#E74C3C",
                "size": 12,
                "shape": "triangle",
                "details": {
                        "Node Type": "DIAMETER_LINK",
                        "Layer": 3,
                        "Mid": "506",
                        "Protocol Type": "SCTP",
                        "Working Mode": "SERVER",
                        "Peer Ip": "172.21.128.101",
                        "Peer Port": "5007",
                        "Local Port": "5007",
                        "Connection": "Local:5007 \u27f7 172.21.128.101:5007"
                },
                "mid": "506",
                "protocol_type": "SCTP",
                "working_mode": "SERVER",
                "peer_ip": "172.21.128.101",
                "peer_port": "5007",
                "local_port": "5007",
                "connection": "Local:5007 \u27f7 172.21.128.101:5007"
        },
        {
                "id": "node_0067",
                "name": "SPS_A_MME_DMLNK04\nLocal:5008 \u27f7 172.21.128.101:5008",
                "type": "DIAMETER_LINK",
                "layer": 3,
                "parent": "node_0062",
                "x": 227.5044061620119,
                "y": -252.66924066231397,
                "color": "#E74C3C",
                "size": 12,
                "shape": "triangle",
                "details": {
                        "Node Type": "DIAMETER_LINK",
                        "Layer": 3,
                        "Mid": "507",
                        "Protocol Type": "SCTP",
                        "Working Mode": "SERVER",
                        "Peer Ip": "172.21.128.101",
                        "Peer Port": "5008",
                        "Local Port": "5008",
                        "Connection": "Local:5008 \u27f7 172.21.128.101:5008"
                },
                "mid": "507",
                "protocol_type": "SCTP",
                "working_mode": "SERVER",
                "peer_ip": "172.21.128.101",
                "peer_port": "5008",
                "local_port": "5008",
                "connection": "Local:5008 \u27f7 172.21.128.101:5008"
        },
        {
                "id": "node_0068",
                "name": "SPS_A_HSS_DMLNK01\nLocal:5010 \u27f7 172.21.128.102:5010",
                "type": "DIAMETER_LINK",
                "layer": 3,
                "parent": "node_0063",
                "x": 234.2487524857334,
                "y": -246.4295476579008,
                "color": "#E74C3C",
                "size": 12,
                "shape": "triangle",
                "details": {
                        "Node Type": "DIAMETER_LINK",
                        "Layer": 3,
                        "Mid": "502",
                        "Protocol Type": "SCTP",
                        "Working Mode": "SERVER",
                        "Peer Ip": "172.21.128.102",
                        "Peer Port": "5010",
                        "Local Port": "5010",
                        "Connection": "Local:5010 \u27f7 172.21.128.102:5010"
                },
                "mid": "502",
                "protocol_type": "SCTP",
                "working_mode": "SERVER",
                "peer_ip": "172.21.128.102",
                "peer_port": "5010",
                "local_port": "5010",
                "connection": "Local:5010 \u27f7 172.21.128.102:5010"
        },
        {
                "id": "node_0069",
                "name": "SPS_A_HSS_DMLNK02\nLocal:5011 \u27f7 172.21.128.102:5011",
                "type": "DIAMETER_LINK",
                "layer": 3,
                "parent": "node_0063",
                "x": 240.4163056034261,
                "y": -240.41630560342622,
                "color": "#E74C3C",
                "size": 12,
                "shape": "triangle",
                "details": {
                        "Node Type": "DIAMETER_LINK",
                        "Layer": 3,
                        "Mid": "503",
                        "Protocol Type": "SCTP",
                        "Working Mode": "SERVER",
                        "Peer Ip": "172.21.128.102",
                        "Peer Port": "5011",
                        "Local Port": "5011",
                        "Connection": "Local:5011 \u27f7 172.21.128.102:5011"
                },
                "mid": "503",
                "protocol_type": "SCTP",
                "working_mode": "SERVER",
                "peer_ip": "172.21.128.102",
                "peer_port": "5011",
                "local_port": "5011",
                "connection": "Local:5011 \u27f7 172.21.128.102:5011"
        },
        {
                "id": "node_0070",
                "name": "SPS_A_HSS_DMLNK03\nLocal:5012 \u27f7 172.21.128.102:5012",
                "type": "DIAMETER_LINK",
                "layer": 3,
                "parent": "node_0063",
                "x": 246.06957295572383,
                "y": -234.6268639039181,
                "color": "#E74C3C",
                "size": 12,
                "shape": "triangle",
                "details": {
                        "Node Type": "DIAMETER_LINK",
                        "Layer": 3,
                        "Mid": "506",
                        "Protocol Type": "SCTP",
                        "Working Mode": "SERVER",
                        "Peer Ip": "172.21.128.102",
                        "Peer Port": "5012",
                        "Local Port": "5012",
                        "Connection": "Local:5012 \u27f7 172.21.128.102:5012"
                },
                "mid": "506",
                "protocol_type": "SCTP",
                "working_mode": "SERVER",
                "peer_ip": "172.21.128.102",
                "peer_port": "5012",
                "local_port": "5012",
                "connection": "Local:5012 \u27f7 172.21.128.102:5012"
        },
        {
                "id": "node_0071",
                "name": "SPS_A_HSS_DMLNK04\nLocal:5013 \u27f7 172.21.128.102:5013",
                "type": "DIAMETER_LINK",
                "layer": 3,
                "parent": "node_0063",
                "x": 251.26303185502394,
                "y": -229.05651883982964,
                "color": "#E74C3C",
                "size": 12,
                "shape": "triangle",
                "details": {
                        "Node Type": "DIAMETER_LINK",
                        "Layer": 3,
                        "Mid": "507",
                        "Protocol Type": "SCTP",
                        "Working Mode": "SERVER",
                        "Peer Ip": "172.21.128.102",
                        "Peer Port": "5013",
                        "Local Port": "5013",
                        "Connection": "Local:5013 \u27f7 172.21.128.102:5013"
                },
                "mid": "507",
                "protocol_type": "SCTP",
                "working_mode": "SERVER",
                "peer_ip": "172.21.128.102",
                "peer_port": "5013",
                "local_port": "5013",
                "connection": "Local:5013 \u27f7 172.21.128.102:5013"
        },
        {
                "id": "node_0072",
                "name": "SPS_A_HLR_N7DSP01",
                "type": "MTP_DSP",
                "layer": 1,
                "parent": null,
                "x": 55.6230589874905,
                "y": -171.19017293312766,
                "color": "#3498DB",
                "size": 25,
                "shape": "hexagon",
                "details": {
                        "Node Type": "MTP_DSP",
                        "Layer": 1,
                        "Point Code": "000301",
                        "Network": "default",
                        "Sua Point": "FALSE"
                },
                "point_code": "000301",
                "network": "default",
                "sua_point": "FALSE"
        },
        {
                "id": "node_0073",
                "name": "SPS_A_MSC_N7DSP01",
                "type": "MTP_DSP",
                "layer": 1,
                "parent": null,
                "x": 65.76138438595116,
                "y": -167.55727475595674,
                "color": "#3498DB",
                "size": 25,
                "shape": "hexagon",
                "details": {
                        "Node Type": "MTP_DSP",
                        "Layer": 1,
                        "Point Code": "000302",
                        "Network": "default",
                        "Sua Point": "FALSE"
                },
                "point_code": "000302",
                "network": "default",
                "sua_point": "FALSE"
        },
        {
                "id": "node_0074",
                "name": "SPS_A_HLR_M3AS01",
                "type": "M3UA_AS",
                "layer": 2,
                "parent": "node_0072",
                "x": 80.34441853748628,
                "y": -247.27469423673995,
                "color": "#27AE60",
                "size": 25,
                "shape": "diamond",
                "details": {
                        "Node Type": "M3UA_AS",
                        "Layer": 2,
                        "Point Code": "SPS_A_HLR_N7DSP01",
                        "Network": "NM",
                        "Dsp Reference": "SPS_A_HLR_N7DSP01"
                },
                "point_code": "SPS_A_HLR_N7DSP01",
                "network": "NM",
                "dsp_reference": "SPS_A_HLR_N7DSP01"
        },
        {
                "id": "node_0075",
                "name": "SPS_A_MSC_M3AS01",
                "type": "M3UA_AS",
                "layer": 2,
                "parent": "node_0073",
                "x": 94.98866633526279,
                "y": -242.02717464749307,
                "color": "#27AE60",
                "size": 25,
                "shape": "diamond",
                "details": {
                        "Node Type": "M3UA_AS",
                        "Layer": 2,
                        "Point Code": "SPS_A_MSC_N7DSP01",
                        "Network": "NM",
                        "Dsp Reference": "SPS_A_MSC_N7DSP01"
                },
                "point_code": "SPS_A_MSC_N7DSP01",
                "network": "NM",
                "dsp_reference": "SPS_A_MSC_N7DSP01"
        },
        {
                "id": "node_0076",
                "name": "SPS_A_HLR_M3LKS01",
                "type": "M3UA_LINKSET",
                "layer": 3,
                "parent": "node_0074",
                "x": 256.0442984412277,
                "y": -223.69916681950235,
                "color": "#27AE60",
                "size": 18,
                "shape": "rect",
                "details": {
                        "Node Type": "M3UA_LINKSET",
                        "Layer": 3,
                        "Entity Name": "SPS_A_HLR_M3AS01",
                        "Office Name": "NULL"
                },
                "entity_name": "SPS_A_HLR_M3AS01",
                "network_indicator": "",
                "office_name": "NULL"
        },
        {
                "id": "node_0077",
                "name": "SPS_A_MSC_M3LKS01",
                "type": "M3UA_LINKSET",
                "layer": 3,
                "parent": "node_0075",
                "x": 260.4551106604525,
                "y": -218.54778729342345,
                "color": "#27AE60",
                "size": 18,
                "shape": "rect",
                "details": {
                        "Node Type": "M3UA_LINKSET",
                        "Layer": 3,
                        "Entity Name": "SPS_A_MSC_M3AS01",
                        "Office Name": "NULL"
                },
                "entity_name": "SPS_A_MSC_M3AS01",
                "network_indicator": "",
                "office_name": "NULL"
        },
        {
                "id": "node_0078",
                "name": "SPS_A_M3LNK_MSC_01\nLocal:1025 \u27f7 172.21.128.105:1025",
                "type": "M3UA_LINK",
                "layer": 4,
                "parent": "node_0077",
                "x": -210.0000000000002,
                "y": -363.7306695894642,
                "color": "#27AE60",
                "size": 12,
                "shape": "triangle",
                "details": {
                        "Node Type": "M3UA_LINK",
                        "Layer": 4,
                        "Remote Ip": "172.21.128.105",
                        "Remote Port": "1025",
                        "Local Port": "1025",
                        "Connection": "Local:1025 \u27f7 172.21.128.105:1025",
                        "Media Id": "525"
                },
                "remote_ip": "172.21.128.105",
                "remote_port": "1025",
                "local_port": "1025",
                "connection": "Local:1025 \u27f7 172.21.128.105:1025",
                "media_id": "525"
        },
        {
                "id": "node_0079",
                "name": "SPS_A_M3LNK_MSC_02\nLocal:1027 \u27f7 172.21.128.105:1027",
                "type": "M3UA_LINK",
                "layer": 4,
                "parent": "node_0077",
                "x": -148.93405255786507,
                "y": -392.70682192787416,
                "color": "#27AE60",
                "size": 12,
                "shape": "triangle",
                "details": {
                        "Node Type": "M3UA_LINK",
                        "Layer": 4,
                        "Remote Ip": "172.21.128.105",
                        "Remote Port": "1027",
                        "Local Port": "1027",
                        "Connection": "Local:1027 \u27f7 172.21.128.105:1027",
                        "Media Id": "526"
                },
                "remote_ip": "172.21.128.105",
                "remote_port": "1027",
                "local_port": "1027",
                "connection": "Local:1027 \u27f7 172.21.128.105:1027",
                "media_id": "526"
        },
        {
                "id": "node_0080",
                "name": "SPS_A_M3LNK_MSC_03\nLocal:1026 \u27f7 172.21.128.105:1026",
                "type": "M3UA_LINK",
                "layer": 4,
                "parent": "node_0077",
                "x": -93.45879226165212,
                "y": -409.4697231163659,
                "color": "#27AE60",
                "size": 12,
                "shape": "triangle",
                "details": {
                        "Node Type": "M3UA_LINK",
                        "Layer": 4,
                        "Remote Ip": "172.21.128.105",
                        "Remote Port": "1026",
                        "Local Port": "1026",
                        "Connection": "Local:1026 \u27f7 172.21.128.105:1026",
                        "Media Id": "529"
                },
                "remote_ip": "172.21.128.105",
                "remote_port": "1026",
                "local_port": "1026",
                "connection": "Local:1026 \u27f7 172.21.128.105:1026",
                "media_id": "529"
        },
        {
                "id": "node_0081",
                "name": "SPS_A_M3LNK_MSC_04\nLocal:1028 \u27f7 172.21.128.105:1028",
                "type": "M3UA_LINK",
                "layer": 4,
                "parent": "node_0077",
                "x": -43.90195457241478,
                "y": -417.69919605467476,
                "color": "#27AE60",
                "size": 12,
                "shape": "triangle",
                "details": {
                        "Node Type": "M3UA_LINK",
                        "Layer": 4,
                        "Remote Ip": "172.21.128.105",
                        "Remote Port": "1028",
                        "Local Port": "1028",
                        "Connection": "Local:1028 \u27f7 172.21.128.105:1028",
                        "Media Id": "530"
                },
                "remote_ip": "172.21.128.105",
                "remote_port": "1028",
                "local_port": "1028",
                "connection": "Local:1028 \u27f7 172.21.128.105:1028",
                "media_id": "530"
        },
        {
                "id": "node_0082",
                "name": "SPS_A_HLR_M3LNK01\nLocal:1125 \u27f7 172.21.128.104:1125",
                "type": "M3UA_LINK",
                "layer": 4,
                "parent": "node_0076",
                "x": -7.715274834628324e-14,
                "y": -420.0,
                "color": "#27AE60",
                "size": 12,
                "shape": "triangle",
                "details": {
                        "Node Type": "M3UA_LINK",
                        "Layer": 4,
                        "Remote Ip": "172.21.128.104",
                        "Remote Port": "1125",
                        "Local Port": "1125",
                        "Connection": "Local:1125 \u27f7 172.21.128.104:1125",
                        "Media Id": "525"
                },
                "remote_ip": "172.21.128.104",
                "remote_port": "1125",
                "local_port": "1125",
                "connection": "Local:1125 \u27f7 172.21.128.104:1125",
                "media_id": "525"
        },
        {
                "id": "node_0083",
                "name": "SPS_A_HLR_M3LNK02\nLocal:1126 \u27f7 172.21.128.104:1126",
                "type": "M3UA_LINK",
                "layer": 4,
                "parent": "node_0076",
                "x": 38.752710974587025,
                "y": -418.2083540439145,
                "color": "#27AE60",
                "size": 12,
                "shape": "triangle",
                "details": {
                        "Node Type": "M3UA_LINK",
                        "Layer": 4,
                        "Remote Ip": "172.21.128.104",
                        "Remote Port": "1126",
                        "Local Port": "1126",
                        "Connection": "Local:1126 \u27f7 172.21.128.104:1126",
                        "Media Id": "526"
                },
                "remote_ip": "172.21.128.104",
                "remote_port": "1126",
                "local_port": "1126",
                "connection": "Local:1126 \u27f7 172.21.128.104:1126",
                "media_id": "526"
        },
        {
                "id": "node_0084",
                "name": "SPS_A_HLR_M3LNK03\nLocal:1127 \u27f7 172.21.128.104:1127",
                "type": "M3UA_LINK",
                "layer": 4,
                "parent": "node_0076",
                "x": 72.93223462011059,
                "y": -413.61925626512743,
                "color": "#27AE60",
                "size": 12,
                "shape": "triangle",
                "details": {
                        "Node Type": "M3UA_LINK",
                        "Layer": 4,
                        "Remote Ip": "172.21.128.104",
                        "Remote Port": "1127",
                        "Local Port": "1127",
                        "Connection": "Local:1127 \u27f7 172.21.128.104:1127",
                        "Media Id": "529"
                },
                "remote_ip": "172.21.128.104",
                "remote_port": "1127",
                "local_port": "1127",
                "connection": "Local:1127 \u27f7 172.21.128.104:1127",
                "media_id": "529"
        },
        {
                "id": "node_0085",
                "name": "SPS_A_HLR_M3LNK04\nLocal:1128 \u27f7 172.21.128.104:1128",
                "type": "M3UA_LINK",
                "layer": 4,
                "parent": "node_0076",
                "x": 103.10390459913549,
                "y": -407.14811169451883,
                "color": "#27AE60",
                "size": 12,
                "shape": "triangle",
                "details": {
                        "Node Type": "M3UA_LINK",
                        "Layer": 4,
                        "Remote Ip": "172.21.128.104",
                        "Remote Port": "1128",
                        "Local Port": "1128",
                        "Connection": "Local:1128 \u27f7 172.21.128.104:1128",
                        "Media Id": "530"
                },
                "remote_ip": "172.21.128.104",
                "remote_port": "1128",
                "local_port": "1128",
                "connection": "Local:1128 \u27f7 172.21.128.104:1128",
                "media_id": "530"
        }
];
        const links = [
        {
                "source": "SPS_LOCAL",
                "target": "node_0001",
                "type": "PEER_CONNECTION",
                "protocol": "DIAMETER"
        },
        {
                "source": "SPS_LOCAL",
                "target": "node_0002",
                "type": "PEER_CONNECTION",
                "protocol": "DIAMETER"
        },
        {
                "source": "node_0001",
                "target": "node_0003",
                "type": "LINKSET_CONNECTION",
                "protocol": "DIAMETER"
        },
        {
                "source": "node_0002",
                "target": "node_0004",
                "type": "LINKSET_CONNECTION",
                "protocol": "DIAMETER"
        },
        {
                "source": "node_0003",
                "target": "node_0005",
                "type": "LINK_CONNECTION",
                "protocol": "DIAMETER",
                "connection_info": "Local:5005 \u27f7 172.21.1.101:5005",
                "peer_ip": "172.21.1.101",
                "peer_port": "5005",
                "local_port": "5005"
        },
        {
                "source": "node_0004",
                "target": "node_0006",
                "type": "LINK_CONNECTION",
                "protocol": "DIAMETER",
                "connection_info": "Local:5006 \u27f7 172.21.1.102:5006",
                "peer_ip": "172.21.1.102",
                "peer_port": "5006",
                "local_port": "5006"
        },
        {
                "source": "node_0003",
                "target": "node_0007",
                "type": "LINK_CONNECTION",
                "protocol": "DIAMETER",
                "connection_info": "Local:5007 \u27f7 172.21.1.101:5007",
                "peer_ip": "172.21.1.101",
                "peer_port": "5007",
                "local_port": "5007"
        },
        {
                "source": "node_0004",
                "target": "node_0008",
                "type": "LINK_CONNECTION",
                "protocol": "DIAMETER",
                "connection_info": "Local:5008 \u27f7 172.21.1.102:5008",
                "peer_ip": "172.21.1.102",
                "peer_port": "5008",
                "local_port": "5008"
        },
        {
                "source": "SPS_LOCAL",
                "target": "node_0009",
                "type": "ENTITY_CONNECTION",
                "protocol": "MTP"
        },
        {
                "source": "node_0009",
                "target": "node_0010",
                "type": "LINKSET_CONNECTION",
                "protocol": "MTP"
        },
        {
                "source": "node_0010",
                "target": "node_0011",
                "type": "LINK_CONNECTION",
                "protocol": "MTP",
                "connection_info": "Local:1225 \u27f7 172.21.128.110:1225",
                "remote_ip": "172.21.128.110",
                "remote_port": "1225",
                "local_port": "1225"
        },
        {
                "source": "node_0010",
                "target": "node_0012",
                "type": "LINK_CONNECTION",
                "protocol": "MTP",
                "connection_info": "Local:1226 \u27f7 172.21.128.110:1226",
                "remote_ip": "172.21.128.110",
                "remote_port": "1226",
                "local_port": "1226"
        },
        {
                "source": "SPS_LOCAL",
                "target": "node_0013",
                "type": "ENTITY_CONNECTION",
                "protocol": "MTP"
        },
        {
                "source": "node_0013",
                "target": "node_0014",
                "type": "AS_CONNECTION",
                "protocol": "M3UA"
        },
        {
                "source": "node_0014",
                "target": "node_0015",
                "type": "LINKSET_CONNECTION",
                "protocol": "M3UA"
        },
        {
                "source": "node_0015",
                "target": "node_0016",
                "type": "LINK_CONNECTION",
                "protocol": "M3UA",
                "connection_info": "Local:1025 \u27f7 172.21.1.10:1025",
                "remote_ip": "172.21.1.10",
                "remote_port": "1025",
                "local_port": "1025"
        },
        {
                "source": "node_0015",
                "target": "node_0017",
                "type": "LINK_CONNECTION",
                "protocol": "M3UA",
                "connection_info": "Local:1026 \u27f7 172.21.1.10:1026",
                "remote_ip": "172.21.1.10",
                "remote_port": "1026",
                "local_port": "1026"
        },
        {
                "source": "SPS_LOCAL",
                "target": "node_0018",
                "type": "ENTITY_CONNECTION",
                "protocol": "MTP"
        },
        {
                "source": "node_0018",
                "target": "node_0019",
                "type": "AS_CONNECTION",
                "protocol": "M3UA"
        },
        {
                "source": "node_0019",
                "target": "node_0020",
                "type": "LINKSET_CONNECTION",
                "protocol": "M3UA"
        },
        {
                "source": "node_0020",
                "target": "node_0021",
                "type": "LINK_CONNECTION",
                "protocol": "M3UA",
                "connection_info": "Local:1125 \u27f7 172.21.129.100:1125",
                "remote_ip": "172.21.129.100",
                "remote_port": "1125",
                "local_port": "1125"
        },
        {
                "source": "node_0020",
                "target": "node_0022",
                "type": "LINK_CONNECTION",
                "protocol": "M3UA",
                "connection_info": "Local:1126 \u27f7 172.21.129.100:1126",
                "remote_ip": "172.21.129.100",
                "remote_port": "1126",
                "local_port": "1126"
        },
        {
                "source": "SPS_LOCAL",
                "target": "node_0023",
                "type": "SG_CONNECTION",
                "protocol": "M2UA"
        },
        {
                "source": "node_0023",
                "target": "node_0024",
                "type": "LINKSET_CONNECTION",
                "protocol": "M2UA"
        },
        {
                "source": "node_0024",
                "target": "node_0025",
                "type": "LINK_CONNECTION",
                "protocol": "M2UA",
                "connection_info": "IPADDR1:5000 \u27f7 172.25.8.9:5000",
                "peer_ip": "172.25.8.9",
                "peer_port": "5000",
                "local_ip": "IPADDR1",
                "local_port": "5000"
        },
        {
                "source": "SPS_LOCAL",
                "target": "node_0026",
                "type": "PEER_CONNECTION",
                "protocol": "DIAMETER"
        },
        {
                "source": "node_0026",
                "target": "node_0027",
                "type": "LINKSET_CONNECTION",
                "protocol": "DIAMETER"
        },
        {
                "source": "node_0027",
                "target": "node_0028",
                "type": "LINK_CONNECTION",
                "protocol": "DIAMETER",
                "connection_info": "Local:5001 \u27f7 172.21.1.103:5001",
                "peer_ip": "172.21.1.103",
                "peer_port": "5001",
                "local_port": "5001"
        },
        {
                "source": "node_0027",
                "target": "node_0029",
                "type": "LINK_CONNECTION",
                "protocol": "DIAMETER",
                "connection_info": "Local:5002 \u27f7 172.21.1.103:5002",
                "peer_ip": "172.21.1.103",
                "peer_port": "5002",
                "local_port": "5002"
        },
        {
                "source": "SPS_LOCAL",
                "target": "node_0030",
                "type": "PEER_CONNECTION",
                "protocol": "DIAMETER"
        },
        {
                "source": "SPS_LOCAL",
                "target": "node_0031",
                "type": "PEER_CONNECTION",
                "protocol": "DIAMETER"
        },
        {
                "source": "node_0030",
                "target": "node_0032",
                "type": "LINKSET_CONNECTION",
                "protocol": "DIAMETER"
        },
        {
                "source": "node_0031",
                "target": "node_0033",
                "type": "LINKSET_CONNECTION",
                "protocol": "DIAMETER"
        },
        {
                "source": "node_0032",
                "target": "node_0034",
                "type": "LINK_CONNECTION",
                "protocol": "DIAMETER",
                "connection_info": "Local:5005 \u27f7 172.21.1.101:5005",
                "peer_ip": "172.21.1.101",
                "peer_port": "5005",
                "local_port": "5005"
        },
        {
                "source": "node_0033",
                "target": "node_0035",
                "type": "LINK_CONNECTION",
                "protocol": "DIAMETER",
                "connection_info": "Local:5006 \u27f7 172.21.1.102:5006",
                "peer_ip": "172.21.1.102",
                "peer_port": "5006",
                "local_port": "5006"
        },
        {
                "source": "node_0032",
                "target": "node_0036",
                "type": "LINK_CONNECTION",
                "protocol": "DIAMETER",
                "connection_info": "Local:5007 \u27f7 172.21.1.101:5007",
                "peer_ip": "172.21.1.101",
                "peer_port": "5007",
                "local_port": "5007"
        },
        {
                "source": "node_0033",
                "target": "node_0037",
                "type": "LINK_CONNECTION",
                "protocol": "DIAMETER",
                "connection_info": "Local:5008 \u27f7 172.21.1.102:5008",
                "peer_ip": "172.21.1.102",
                "peer_port": "5008",
                "local_port": "5008"
        },
        {
                "source": "SPS_LOCAL",
                "target": "node_0038",
                "type": "ENTITY_CONNECTION",
                "protocol": "MTP"
        },
        {
                "source": "node_0038",
                "target": "node_0039",
                "type": "LINKSET_CONNECTION",
                "protocol": "MTP"
        },
        {
                "source": "node_0039",
                "target": "node_0040",
                "type": "LINK_CONNECTION",
                "protocol": "MTP",
                "connection_info": "Local:1225 \u27f7 172.21.128.110:1225",
                "remote_ip": "172.21.128.110",
                "remote_port": "1225",
                "local_port": "1225"
        },
        {
                "source": "node_0039",
                "target": "node_0041",
                "type": "LINK_CONNECTION",
                "protocol": "MTP",
                "connection_info": "Local:1226 \u27f7 172.21.128.110:1226",
                "remote_ip": "172.21.128.110",
                "remote_port": "1226",
                "local_port": "1226"
        },
        {
                "source": "SPS_LOCAL",
                "target": "node_0042",
                "type": "ENTITY_CONNECTION",
                "protocol": "MTP"
        },
        {
                "source": "node_0042",
                "target": "node_0043",
                "type": "AS_CONNECTION",
                "protocol": "M3UA"
        },
        {
                "source": "node_0043",
                "target": "node_0044",
                "type": "LINKSET_CONNECTION",
                "protocol": "M3UA"
        },
        {
                "source": "node_0044",
                "target": "node_0045",
                "type": "LINK_CONNECTION",
                "protocol": "M3UA",
                "connection_info": "Local:1025 \u27f7 172.21.1.10:1025",
                "remote_ip": "172.21.1.10",
                "remote_port": "1025",
                "local_port": "1025"
        },
        {
                "source": "node_0044",
                "target": "node_0046",
                "type": "LINK_CONNECTION",
                "protocol": "M3UA",
                "connection_info": "Local:1026 \u27f7 172.21.1.10:1026",
                "remote_ip": "172.21.1.10",
                "remote_port": "1026",
                "local_port": "1026"
        },
        {
                "source": "SPS_LOCAL",
                "target": "node_0047",
                "type": "ENTITY_CONNECTION",
                "protocol": "MTP"
        },
        {
                "source": "node_0047",
                "target": "node_0048",
                "type": "AS_CONNECTION",
                "protocol": "M3UA"
        },
        {
                "source": "node_0048",
                "target": "node_0049",
                "type": "LINKSET_CONNECTION",
                "protocol": "M3UA"
        },
        {
                "source": "node_0049",
                "target": "node_0050",
                "type": "LINK_CONNECTION",
                "protocol": "M3UA",
                "connection_info": "Local:1125 \u27f7 172.21.129.100:1125",
                "remote_ip": "172.21.129.100",
                "remote_port": "1125",
                "local_port": "1125"
        },
        {
                "source": "node_0049",
                "target": "node_0051",
                "type": "LINK_CONNECTION",
                "protocol": "M3UA",
                "connection_info": "Local:1126 \u27f7 172.21.129.100:1126",
                "remote_ip": "172.21.129.100",
                "remote_port": "1126",
                "local_port": "1126"
        },
        {
                "source": "SPS_LOCAL",
                "target": "node_0052",
                "type": "PEER_CONNECTION",
                "protocol": "DIAMETER"
        },
        {
                "source": "node_0052",
                "target": "node_0053",
                "type": "LINKSET_CONNECTION",
                "protocol": "DIAMETER"
        },
        {
                "source": "node_0053",
                "target": "node_0054",
                "type": "LINK_CONNECTION",
                "protocol": "DIAMETER",
                "connection_info": "Local:5001 \u27f7 172.21.128.103:5001",
                "peer_ip": "172.21.128.103",
                "peer_port": "5001",
                "local_port": "5001"
        },
        {
                "source": "node_0053",
                "target": "node_0055",
                "type": "LINK_CONNECTION",
                "protocol": "DIAMETER",
                "connection_info": "Local:5002 \u27f7 172.21.128.103:5002",
                "peer_ip": "172.21.128.103",
                "peer_port": "5002",
                "local_port": "5002"
        },
        {
                "source": "SPS_LOCAL",
                "target": "node_0056",
                "type": "ENTITY_CONNECTION",
                "protocol": "MTP"
        },
        {
                "source": "node_0056",
                "target": "node_0057",
                "type": "LINKSET_CONNECTION",
                "protocol": "MTP"
        },
        {
                "source": "node_0057",
                "target": "node_0058",
                "type": "LINK_CONNECTION",
                "protocol": "MTP",
                "connection_info": "Local:5003 \u27f7 172.21.128.103:5003",
                "remote_ip": "172.21.128.103",
                "remote_port": "5003",
                "local_port": "5003"
        },
        {
                "source": "node_0057",
                "target": "node_0059",
                "type": "LINK_CONNECTION",
                "protocol": "MTP",
                "connection_info": "Local:5004 \u27f7 172.21.128.103:5004",
                "remote_ip": "172.21.128.103",
                "remote_port": "5004",
                "local_port": "5004"
        },
        {
                "source": "SPS_LOCAL",
                "target": "node_0060",
                "type": "PEER_CONNECTION",
                "protocol": "DIAMETER"
        },
        {
                "source": "SPS_LOCAL",
                "target": "node_0061",
                "type": "PEER_CONNECTION",
                "protocol": "DIAMETER"
        },
        {
                "source": "node_0060",
                "target": "node_0062",
                "type": "LINKSET_CONNECTION",
                "protocol": "DIAMETER"
        },
        {
                "source": "node_0061",
                "target": "node_0063",
                "type": "LINKSET_CONNECTION",
                "protocol": "DIAMETER"
        },
        {
                "source": "node_0062",
                "target": "node_0064",
                "type": "LINK_CONNECTION",
                "protocol": "DIAMETER",
                "connection_info": "Local:5005 \u27f7 172.21.128.101:5005",
                "peer_ip": "172.21.128.101",
                "peer_port": "5005",
                "local_port": "5005"
        },
        {
                "source": "node_0062",
                "target": "node_0065",
                "type": "LINK_CONNECTION",
                "protocol": "DIAMETER",
                "connection_info": "Local:5006 \u27f7 172.21.128.101:5006",
                "peer_ip": "172.21.128.101",
                "peer_port": "5006",
                "local_port": "5006"
        },
        {
                "source": "node_0062",
                "target": "node_0066",
                "type": "LINK_CONNECTION",
                "protocol": "DIAMETER",
                "connection_info": "Local:5007 \u27f7 172.21.128.101:5007",
                "peer_ip": "172.21.128.101",
                "peer_port": "5007",
                "local_port": "5007"
        },
        {
                "source": "node_0062",
                "target": "node_0067",
                "type": "LINK_CONNECTION",
                "protocol": "DIAMETER",
                "connection_info": "Local:5008 \u27f7 172.21.128.101:5008",
                "peer_ip": "172.21.128.101",
                "peer_port": "5008",
                "local_port": "5008"
        },
        {
                "source": "node_0063",
                "target": "node_0068",
                "type": "LINK_CONNECTION",
                "protocol": "DIAMETER",
                "connection_info": "Local:5010 \u27f7 172.21.128.102:5010",
                "peer_ip": "172.21.128.102",
                "peer_port": "5010",
                "local_port": "5010"
        },
        {
                "source": "node_0063",
                "target": "node_0069",
                "type": "LINK_CONNECTION",
                "protocol": "DIAMETER",
                "connection_info": "Local:5011 \u27f7 172.21.128.102:5011",
                "peer_ip": "172.21.128.102",
                "peer_port": "5011",
                "local_port": "5011"
        },
        {
                "source": "node_0063",
                "target": "node_0070",
                "type": "LINK_CONNECTION",
                "protocol": "DIAMETER",
                "connection_info": "Local:5012 \u27f7 172.21.128.102:5012",
                "peer_ip": "172.21.128.102",
                "peer_port": "5012",
                "local_port": "5012"
        },
        {
                "source": "node_0063",
                "target": "node_0071",
                "type": "LINK_CONNECTION",
                "protocol": "DIAMETER",
                "connection_info": "Local:5013 \u27f7 172.21.128.102:5013",
                "peer_ip": "172.21.128.102",
                "peer_port": "5013",
                "local_port": "5013"
        },
        {
                "source": "SPS_LOCAL",
                "target": "node_0072",
                "type": "ENTITY_CONNECTION",
                "protocol": "MTP"
        },
        {
                "source": "SPS_LOCAL",
                "target": "node_0073",
                "type": "ENTITY_CONNECTION",
                "protocol": "MTP"
        },
        {
                "source": "node_0072",
                "target": "node_0074",
                "type": "AS_CONNECTION",
                "protocol": "M3UA"
        },
        {
                "source": "node_0073",
                "target": "node_0075",
                "type": "AS_CONNECTION",
                "protocol": "M3UA"
        },
        {
                "source": "node_0074",
                "target": "node_0076",
                "type": "LINKSET_CONNECTION",
                "protocol": "M3UA"
        },
        {
                "source": "node_0075",
                "target": "node_0077",
                "type": "LINKSET_CONNECTION",
                "protocol": "M3UA"
        },
        {
                "source": "node_0077",
                "target": "node_0078",
                "type": "LINK_CONNECTION",
                "protocol": "M3UA",
                "connection_info": "Local:1025 \u27f7 172.21.128.105:1025",
                "remote_ip": "172.21.128.105",
                "remote_port": "1025",
                "local_port": "1025"
        },
        {
                "source": "node_0077",
                "target": "node_0079",
                "type": "LINK_CONNECTION",
                "protocol": "M3UA",
                "connection_info": "Local:1027 \u27f7 172.21.128.105:1027",
                "remote_ip": "172.21.128.105",
                "remote_port": "1027",
                "local_port": "1027"
        },
        {
                "source": "node_0077",
                "target": "node_0080",
                "type": "LINK_CONNECTION",
                "protocol": "M3UA",
                "connection_info": "Local:1026 \u27f7 172.21.128.105:1026",
                "remote_ip": "172.21.128.105",
                "remote_port": "1026",
                "local_port": "1026"
        },
        {
                "source": "node_0077",
                "target": "node_0081",
                "type": "LINK_CONNECTION",
                "protocol": "M3UA",
                "connection_info": "Local:1028 \u27f7 172.21.128.105:1028",
                "remote_ip": "172.21.128.105",
                "remote_port": "1028",
                "local_port": "1028"
        },
        {
                "source": "node_0076",
                "target": "node_0082",
                "type": "LINK_CONNECTION",
                "protocol": "M3UA",
                "connection_info": "Local:1125 \u27f7 172.21.128.104:1125",
                "remote_ip": "172.21.128.104",
                "remote_port": "1125",
                "local_port": "1125"
        },
        {
                "source": "node_0076",
                "target": "node_0083",
                "type": "LINK_CONNECTION",
                "protocol": "M3UA",
                "connection_info": "Local:1126 \u27f7 172.21.128.104:1126",
                "remote_ip": "172.21.128.104",
                "remote_port": "1126",
                "local_port": "1126"
        },
        {
                "source": "node_0076",
                "target": "node_0084",
                "type": "LINK_CONNECTION",
                "protocol": "M3UA",
                "connection_info": "Local:1127 \u27f7 172.21.128.104:1127",
                "remote_ip": "172.21.128.104",
                "remote_port": "1127",
                "local_port": "1127"
        },
        {
                "source": "node_0076",
                "target": "node_0085",
                "type": "LINK_CONNECTION",
                "protocol": "M3UA",
                "connection_info": "Local:1128 \u27f7 172.21.128.104:1128",
                "remote_ip": "172.21.128.104",
                "remote_port": "1128",
                "local_port": "1128"
        }
];
        
        // SVG setup
        const svg = d3.select("#topology");
        const container = d3.select(".main-content");
        
        // Get container dimensions
        const containerRect = container.node().getBoundingClientRect();
        const width = containerRect.width;
        const height = containerRect.height;
        
        svg.attr("width", width).attr("height", height);
        
        // Create zoom behavior
        const zoom = d3.zoom()
            .scaleExtent([0.1, 4])
            .on("zoom", handleZoom);
        
        svg.call(zoom);
        
        // Create main group for zooming/panning
        const g = svg.append("g");
        
        // Create tooltip
        const tooltip = d3.select("body").append("div")
            .attr("class", "tooltip")
            .style("opacity", 0);
        
        // Global variables for enhanced functionality
        let selectedNodes = new Set();
        let isDragging = false;
        let dragStartPos = null;
        let selectionRect = null;
        let currentSearchResults = new Set();
        let currentProtocolFilter = null;
        let layoutMultiplier = 1.0;
        let contextMenu = null;
        
        // Force simulation with improved forces
        const simulation = d3.forceSimulation(nodes)
            .force("link", d3.forceLink(links).id(d => d.id).distance(d => {
                // Dynamic distance based on node layers and layout multiplier
                const sourceLayer = d.source.layer || 0;
                const targetLayer = d.target.layer || 0;
                const baseDistance = 60 + (Math.abs(sourceLayer - targetLayer) * 20);
                return baseDistance * layoutMultiplier;
            }))
            .force("charge", d3.forceManyBody().strength(d => {
                // Stronger repulsion for central nodes, scaled by layout multiplier
                const baseStrength = d.layer === 0 ? -800 : -300;
                return baseStrength * layoutMultiplier;
            }))
            .force("center", d3.forceCenter(width / 2, height / 2))
            .force("collision", d3.forceCollide().radius(d => (d.size + 8) * layoutMultiplier))
            .force("radial", d3.forceRadial(d => {
                // Radial positioning based on layers with proper spacing
                const baseRadius = 60 + (d.layer * 50);
                return baseRadius * layoutMultiplier;
            }, width / 2, height / 2).strength(0.1));
        
        // Create links
        const link = g.append("g")
            .selectAll("line")
            .data(links)
            .join("line")
            .attr("class", "link")
            .style("stroke-width", d => {
                // Thicker lines for higher layer connections
                const maxLayer = Math.max(d.source.layer || 0, d.target.layer || 0);
                return Math.max(2, 4 - maxLayer);
            })
            .style("marker-end", "url(#arrow)")
            .on("mouseover", function(event, d) {
                d3.select(this).classed("flow-active", true);
                // Show link tooltip with connection info
                if (d.connection_info) {
                    tooltip.transition()
                        .duration(200)
                        .style("opacity", .9);
                    
                    tooltip.html(`
                        <h4>${d.type} - ${d.protocol}</h4>
                        <div class="tooltip-content">
                            <div>Connection:</div><div>${d.connection_info}</div>
                            ${d.remote_ip ? `<div>Remote IP:</div><div>${d.remote_ip}</div>` : ''}
                            ${d.remote_port ? `<div>Remote Port:</div><div>${d.remote_port}</div>` : ''}
                            ${d.local_port ? `<div>Local Port:</div><div>${d.local_port}</div>` : ''}
                        </div>
                    `)
                    .style("left", (event.pageX + 10) + "px")
                    .style("top", (event.pageY - 28) + "px");
                }
            })
            .on("mouseout", function(event, d) {
                d3.select(this).classed("flow-active", false);
                tooltip.transition()
                    .duration(500)
                    .style("opacity", 0);
            });
        
        // Add arrow markers
        g.append("defs").append("marker")
            .attr("id", "arrow")
            .attr("viewBox", "0 -5 10 10")
            .attr("refX", 15)
            .attr("refY", 0)
            .attr("markerWidth", 6)
            .attr("markerHeight", 6)
            .attr("orient", "auto")
            .append("path")
            .attr("d", "M0,-5L10,0L0,5")
            .attr("class", "arrow")
            .style("fill", "rgba(255, 255, 255, 0.6)");
        
        // Create nodes
        const node = g.append("g")
            .selectAll("circle")
            .data(nodes)
            .join("circle")
            .attr("class", "node")
            .attr("r", d => d.size)
            .attr("fill", d => d.color)
            .call(enhancedDrag(simulation))
            .on("mouseover", showTooltip)
            .on("mousemove", moveTooltip)
            .on("mouseout", hideTooltip)
            .on("click", enhancedNodeClick)
            .on("contextmenu", showContextMenu);
        
        // Create labels with multi-line support
        let labelsVisible = true;
        const labels = g.append("g")
            .selectAll("g")
            .data(nodes)
            .join("g")
            .attr("class", "node-label-group");
        
        // Function to intelligently split long node names
        function splitNodeName(name, maxCharsPerLine = 12) {
            if (name.length <= maxCharsPerLine) {
                return [name];
            }
            
            const lines = [];
            const parts = name.split('_');
            let currentLine = '';
            
            for (let i = 0; i < parts.length; i++) {
                const part = parts[i];
                const testLine = currentLine ? currentLine + '_' + part : part;
                
                if (testLine.length <= maxCharsPerLine) {
                    currentLine = testLine;
                } else {
                    if (currentLine) {
                        lines.push(currentLine);
                        currentLine = part;
                    } else {
                        // If a single part is too long, split it
                        if (part.length > maxCharsPerLine) {
                            for (let j = 0; j < part.length; j += maxCharsPerLine) {
                                lines.push(part.substring(j, j + maxCharsPerLine));
                            }
                        } else {
                            lines.push(part);
                        }
                        currentLine = '';
                    }
                }
            }
            
            if (currentLine) {
                lines.push(currentLine);
            }
            
            return lines;
        }

        // Add main text elements with tspan for multi-line
        labels.each(function(d) {
            const group = d3.select(this);
            let labelLines = [];
            
            // First line: Always show the node name (or simplified version)
            if (d.type.includes('LINK') && d.connection) {
                // For LINK nodes: First line is link name, second line is connection
                const linkName = d.name.split(/[\s\(]/)[0]; // Get first word before space or parenthesis
                labelLines.push(linkName);
                labelLines.push(d.connection);
            } else if (d.type === 'SPS_CORE') {
                // For core node: Just show the name
                labelLines.push(d.name);
            } else {
                // For all other nodes: First line is node name, second line is type and details
                const nameLines = splitNodeName(d.name);
                labelLines.push(nameLines[0]); // First part of name on first line
                
                // Second line: Combine remaining name parts + type + details
                let secondLine = '';
                
                // Add remaining name parts if any
                if (nameLines.length > 1) {
                    secondLine = nameLines.slice(1).join('_');
                }
                
                // Add type information
                const typeShort = d.type.replace(/_/g, '').substring(0, 6);
                if (secondLine) {
                    secondLine += ` [${typeShort}]`;
                } else {
                    secondLine = `[${typeShort}]`;
                }
                
                // Add specific details based on node type
                if (d.type === 'DIAMETER_PEER' && d.hostname) {
                    secondLine += ` ${d.hostname}`;
                } else if ((d.type === 'MTP_DSP' || d.type === 'M3UA_AS') && d.point_code) {
                    secondLine += ` SPC:${d.point_code}`;
                } else if (d.connection) {
                    secondLine += ` ${d.connection}`;
                }
                
                labelLines.push(secondLine);
            }
            
            // Create text element with tspan elements
            const textElement = group.append("text")
                .attr("class", "node-label")
                .style("font-size", Math.max(8, d.size / 3) + "px");
            
            // Add each line as a tspan with improved spacing
            labelLines.forEach((line, index) => {
                textElement.append("tspan")
                    .attr("x", 0)
                    .attr("dy", index === 0 ? "0" : "1.1em") // Better line spacing
                    .text(line);
            });
        });
        
        // Enhanced multi-select functionality
        svg.on("mousedown", function(event) {
            if (event.ctrlKey || event.metaKey) {
                event.preventDefault();
                startRectSelection(event);
            }
        });
        
        function startRectSelection(event) {
            const [x, y] = d3.pointer(event, g.node());
            dragStartPos = {x, y};
            isDragging = true;
            
            selectionRect = g.append("rect")
                .attr("class", "selection-rect")
                .attr("x", x)
                .attr("y", y)
                .attr("width", 0)
                .attr("height", 0);
            
            svg.on("mousemove.selection", function(event) {
                if (!isDragging) return;
                
                const [currentX, currentY] = d3.pointer(event, g.node());
                const rectX = Math.min(dragStartPos.x, currentX);
                const rectY = Math.min(dragStartPos.y, currentY);
                const rectWidth = Math.abs(currentX - dragStartPos.x);
                const rectHeight = Math.abs(currentY - dragStartPos.y);
                
                selectionRect
                    .attr("x", rectX)
                    .attr("y", rectY)
                    .attr("width", rectWidth)
                    .attr("height", rectHeight);
                
                // Select nodes within rectangle
                node.each(function(d) {
                    const nodeX = d.x;
                    const nodeY = d.y;
                    if (nodeX >= rectX && nodeX <= rectX + rectWidth &&
                        nodeY >= rectY && nodeY <= rectY + rectHeight) {
                        selectedNodes.add(d.id);
                        d3.select(this).classed("selected", true);
                    }
                });
            });
            
            svg.on("mouseup.selection", function() {
                isDragging = false;
                if (selectionRect) {
                    selectionRect.remove();
                    selectionRect = null;
                }
                svg.on("mousemove.selection", null);
                svg.on("mouseup.selection", null);
            });
        }
        
        // Update positions on simulation tick
        simulation.on("tick", () => {
            link
                .attr("x1", d => d.source.x)
                .attr("y1", d => d.source.y)
                .attr("x2", d => d.target.x)
                .attr("y2", d => d.target.y);
            
            node
                .attr("cx", d => d.x)
                .attr("cy", d => d.y);
            
            // Position labels with better spacing to prevent overlap
            labels
                .attr("transform", d => {
                    // Offset label below the node to prevent overlap with the node itself
                    const labelOffsetY = d.size + 12; // Position label below the node
                    return `translate(${d.x}, ${d.y + labelOffsetY})`;
                });
        });
        
        // Enhanced search functionality with RegExp support
        function handleSearch() {
            const searchTerm = document.getElementById('searchInput').value.trim();
            const useRegex = document.getElementById('regexCheckbox').checked;
            const filterStatus = document.getElementById('filterStatus');
            
            // Clear previous search results
            currentSearchResults.clear();
            
            if (!searchTerm) {
                updateFilterStatus();
                applyCombinedFilter();
                return;
            }
            
            let pattern;
            let matchCount = 0;
            
            try {
                if (useRegex) {
                    pattern = new RegExp(searchTerm, 'i');
                } else {
                    // Simple text search
                }
                
                // Search and highlight matching nodes
                nodes.forEach(nodeData => {
                    let isMatch = false;
                    
                    if (useRegex) {
                        isMatch = pattern.test(nodeData.name) || 
                                 (nodeData.details && Object.values(nodeData.details).some(val => 
                                     typeof val === 'string' && pattern.test(val)));
                    } else {
                        const searchLower = searchTerm.toLowerCase();
                        isMatch = nodeData.name.toLowerCase().includes(searchLower) ||
                                 (nodeData.details && Object.values(nodeData.details).some(val => 
                                     typeof val === 'string' && val.toLowerCase().includes(searchLower)));
                    }
                    
                    if (isMatch) {
                        currentSearchResults.add(nodeData.id);
                        matchCount++;
                    }
                });
                
                // Apply combined search and protocol filter
                applyCombinedFilter();
                
                // Update filter status with combined information
                updateFilterStatus();
                
            } catch (error) {
                // Handle invalid regex
                if (useRegex) {
                    filterStatus.textContent = `Invalid RegExp: ${searchTerm}`;
                    console.warn('Invalid regex pattern:', error);
                } else {
                    // Fallback to simple search
                    handleSearch();
                }
            }
        }
        
        function applySearchFilter(searchResults) {
            // Find all connected nodes (parents and children) in the full hierarchical path
            const highlightedNodes = new Set(searchResults);
            const highlightedLinks = new Set();
            
            // Function to recursively trace full path from root to leaves
            function traceFullPath(nodeId, visited = new Set()) {
                if (visited.has(nodeId)) return; // Prevent infinite loops
                visited.add(nodeId);
                highlightedNodes.add(nodeId);
                
                // Find all connections (both parent and child relationships)
                links.forEach(link => {
                    const sourceId = typeof link.source === 'object' ? link.source.id : link.source;
                    const targetId = typeof link.target === 'object' ? link.target.id : link.target;
                    
                    if (sourceId === nodeId) {
                        // This node is the source, target is connected
                        highlightedNodes.add(targetId);
                        highlightedLinks.add(link);
                        traceFullPath(targetId, visited);
                    } else if (targetId === nodeId) {
                        // This node is the target, source is connected
                        highlightedNodes.add(sourceId);
                        highlightedLinks.add(link);
                        traceFullPath(sourceId, visited);
                    }
                });
                
                // Also trace using parent-child relationships from node data
                const currentNode = nodes.find(n => n.id === nodeId);
                if (currentNode) {
                    // Trace upward to root
                    if (currentNode.parent && !visited.has(currentNode.parent)) {
                        traceFullPath(currentNode.parent, visited);
                    }
                    
                    // Trace downward to all children
                    nodes.forEach(node => {
                        if (node.parent === nodeId && !visited.has(node.id)) {
                            traceFullPath(node.id, visited);
                        }
                    });
                }
            }
            
            // Trace full paths for all search results with a shared visited set
            const globalVisited = new Set();
            searchResults.forEach(nodeId => {
                traceFullPath(nodeId, globalVisited);
            });
            
            // Apply visual effects
            node.each(function(d) {
                const element = d3.select(this);
                if (searchResults.has(d.id)) {
                    // Primary matches get LED breathing effect
                    element.classed("search-match", true)
                           .classed("filtered", false)
                           .classed("highlighted", true);
                } else if (highlightedNodes.has(d.id)) {
                    // Connected nodes in the path are highlighted but no LED effect
                    element.classed("search-match", false)
                           .classed("filtered", false)
                           .classed("highlighted", true);
                } else {
                    // Non-matching nodes are filtered
                    element.classed("search-match", false)
                           .classed("filtered", true)
                           .classed("highlighted", false);
                }
            });
            
            // Highlight all connected links in the path
            link.each(function(d) {
                const element = d3.select(this);
                if (highlightedLinks.has(d)) {
                    element.classed("filtered", false)
                           .classed("highlighted", true);
                } else {
                    element.classed("filtered", true)
                           .classed("highlighted", false);
                }
            });
        }
        
        function applyCombinedFilter() {
            // Clear all filter states first
            node.classed("search-match", false)
                .classed("filtered", false)
                .classed("highlighted", false);
            
            link.classed("filtered", false)
                .classed("highlighted", false);
            
            // If no search and no protocol filter, show everything
            if (currentSearchResults.size === 0 && !currentProtocolFilter) {
                return;
            }
            
            // Apply combined filtering logic
            if (currentSearchResults.size > 0 && currentProtocolFilter) {
                // Both search and protocol filter active
                applyCombinedSearchAndProtocolFilter();
            } else if (currentSearchResults.size > 0) {
                // Only search filter active
                applySearchFilter(currentSearchResults);
            } else if (currentProtocolFilter) {
                // Only protocol filter active
                applyProtocolFilter(currentProtocolFilter);
            }
        }
        
        function applyCombinedSearchAndProtocolFilter() {
            // Find nodes that match both search criteria AND protocol
            const highlightedNodes = new Set();
            const highlightedLinks = new Set();
            
            // Function to recursively trace full path from root to leaves
            function traceFullPath(nodeId, visited = new Set()) {
                if (visited.has(nodeId)) return;
                visited.add(nodeId);
                
                const nodeData = nodes.find(n => n.id === nodeId);
                const nodeProtocol = getNodeProtocol(nodeData);
                
                // Only include nodes that match the protocol filter OR are central/parent nodes
                if (nodeProtocol === currentProtocolFilter || nodeData.id === 'SPS_LOCAL' || nodeData.layer === 0) {
                    highlightedNodes.add(nodeId);
                }
                
                // Find all connections
                links.forEach(link => {
                    const sourceId = typeof link.source === 'object' ? link.source.id : link.source;
                    const targetId = typeof link.target === 'object' ? link.target.id : link.target;
                    
                    if (sourceId === nodeId || targetId === nodeId) {
                        // Only include links that match the protocol filter
                        if (link.protocol === currentProtocolFilter) {
                            highlightedLinks.add(link);
                            
                            if (sourceId === nodeId) {
                                traceFullPath(targetId, visited);
                            } else {
                                traceFullPath(sourceId, visited);
                            }
                        }
                    }
                });
                
                // Also trace using parent-child relationships
                if (nodeData) {
                    if (nodeData.parent && !visited.has(nodeData.parent)) {
                        traceFullPath(nodeData.parent, visited);
                    }
                    
                    nodes.forEach(node => {
                        if (node.parent === nodeId && !visited.has(node.id)) {
                            const childProtocol = getNodeProtocol(node);
                            if (childProtocol === currentProtocolFilter) {
                                traceFullPath(node.id, visited);
                            }
                        }
                    });
                }
            }
            
            // Trace paths for search results that also match protocol
            currentSearchResults.forEach(nodeId => {
                const nodeData = nodes.find(n => n.id === nodeId);
                const nodeProtocol = getNodeProtocol(nodeData);
                
                // Only trace if the node matches the protocol filter or is a central node
                if (nodeProtocol === currentProtocolFilter || nodeData.id === 'SPS_LOCAL' || nodeData.layer === 0) {
                    traceFullPath(nodeId);
                }
            });
            
            // Apply visual effects
            node.each(function(d) {
                const element = d3.select(this);
                const nodeProtocol = getNodeProtocol(d);
                const matchesSearch = currentSearchResults.has(d.id);
                const matchesProtocol = nodeProtocol === currentProtocolFilter || d.id === 'SPS_LOCAL';
                
                if (matchesSearch && matchesProtocol) {
                    // Primary matches: both search and protocol
                    element.classed("search-match", true)
                           .classed("filtered", false)
                           .classed("highlighted", true);
                } else if (highlightedNodes.has(d.id) && matchesProtocol) {
                    // Connected nodes in the path that match protocol
                    element.classed("search-match", false)
                           .classed("filtered", false)
                           .classed("highlighted", true);
                } else {
                    // Non-matching nodes are filtered
                    element.classed("search-match", false)
                           .classed("filtered", true)
                           .classed("highlighted", false);
                }
            });
            
            // Highlight links that match protocol
            link.each(function(d) {
                const element = d3.select(this);
                if (highlightedLinks.has(d) && d.protocol === currentProtocolFilter) {
                    element.classed("filtered", false)
                           .classed("highlighted", true);
                } else {
                    element.classed("filtered", true)
                           .classed("highlighted", false);
                }
            });
        }
        
        function applyProtocolFilter(protocol) {
            // Filter nodes and links by protocol only
            node.each(function(d) {
                const element = d3.select(this);
                const nodeProtocol = getNodeProtocol(d);
                
                if (nodeProtocol === protocol || d.id === 'SPS_LOCAL') {
                    element.classed("filtered", false)
                           .classed("highlighted", true);
                } else {
                    element.classed("filtered", true)
                           .classed("highlighted", false);
                }
            });
            
            link.each(function(d) {
                const element = d3.select(this);
                if (d.protocol === protocol) {
                    element.classed("filtered", false)
                           .classed("highlighted", true);
                } else {
                    element.classed("filtered", true)
                           .classed("highlighted", false);
                }
            });
        }
        
        function updateFilterStatus() {
            const filterStatus = document.getElementById('filterStatus');
            const searchTerm = document.getElementById('searchInput').value.trim();
            const useRegex = document.getElementById('regexCheckbox').checked;
            
            let statusParts = [];
            
            if (searchTerm) {
                const matchCount = currentSearchResults.size;
                const searchText = useRegex ? 
                    `RegExp: ${searchTerm} (${matchCount} matches)` :
                    `Search: "${searchTerm}" (${matchCount} matches)`;
                statusParts.push(searchText);
            }
            
            if (currentProtocolFilter) {
                statusParts.push(`${currentProtocolFilter} filter`);
            }
            
            if (statusParts.length === 0) {
                filterStatus.textContent = 'No filter';
            } else {
                filterStatus.textContent = statusParts.join(' + ');
            }
        }
        
        function clearSearchResults() {
            // Remove all search-related classes
            node.classed("search-match", false)
                .classed("filtered", false)
                .classed("highlighted", false);
            
            link.classed("filtered", false)
                .classed("highlighted", false);
            
            currentSearchResults.clear();
        }
        
        function clearSearch() {
            document.getElementById('searchInput').value = '';
            currentSearchResults.clear();
            updateFilterStatus();
            applyCombinedFilter(); // This will now apply protocol filter if one is active, or show all
        }
        
        function clearAllFilters() {
            document.getElementById('searchInput').value = '';
            currentSearchResults.clear();
            currentProtocolFilter = null;
            
            // Reset all button states
            document.querySelectorAll('.protocol-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            document.getElementById('btnAll').classList.add('active');
            
            updateFilterStatus();
            applyCombinedFilter();
        }
        
        // Context menu functionality
        function showContextMenu(event, d) {
            event.preventDefault();
            event.stopPropagation();
            hideContextMenu();
            
            contextMenu = d3.select("body")
                .append("div")
                .attr("class", "context-menu")
                .style("left", event.pageX + "px")
                .style("top", event.pageY + "px");
            
            // Add menu items
            contextMenu.append("div")
                .attr("class", "context-menu-item")
                .text("📋 Copy Node Info")
                .on("click", () => copyNodeInfo(d));
            
            // Add MML command copy if available
            if (d.mml_command || d.details) {
                contextMenu.append("div")
                    .attr("class", "context-menu-item")
                    .text("📝 Copy Details")
                    .on("click", () => copyNodeDetails(d));
            }
            
            contextMenu.append("div").attr("class", "context-menu-separator");
            
            // Network metadata section
            contextMenu.append("div")
                .attr("class", "context-menu-item")
                .text("🌐 Copy Network Metadata")
                .on("click", () => copyNetworkMetadata());
            
            contextMenu.append("div")
                .attr("class", "context-menu-item")
                .text("📊 Copy All IP Addresses")
                .on("click", () => copyAllIPs());
            
            contextMenu.append("div")
                .attr("class", "context-menu-item")
                .text("🔌 Copy All Ports")
                .on("click", () => copyAllPorts());
            
            contextMenu.append("div")
                .attr("class", "context-menu-item")
                .text("🔗 Copy IP:Port Pairs")
                .on("click", () => copyIPPortPairs());
            
            contextMenu.append("div").attr("class", "context-menu-separator");
            
            contextMenu.append("div")
                .attr("class", "context-menu-item")
                .text("🎯 Center on Node")
                .on("click", () => centerOnNode(d));
            
            contextMenu.append("div")
                .attr("class", "context-menu-item")
                .text("🔗 Highlight Path")
                .on("click", () => highlightPath(d));
            
            contextMenu.append("div")
                .attr("class", "context-menu-item")
                .text("🔍 Show Connected")
                .on("click", () => showConnectedNodes(d));
            
            contextMenu.append("div").attr("class", "context-menu-separator");
            
            contextMenu.append("div")
                .attr("class", "context-menu-item")
                .text("🏷️ Add to Selection")
                .on("click", () => addToSelection(d));
            
            contextMenu.append("div")
                .attr("class", "context-menu-item")
                .text("📌 Pin Node")
                .on("click", () => pinNode(d));
            
            if (d.fx !== null || d.fy !== null) {
                contextMenu.append("div")
                    .attr("class", "context-menu-item")
                    .text("📍 Unpin Node")
                    .on("click", () => unpinNode(d));
            }
        }
        
        function hideContextMenu() {
            if (contextMenu) {
                contextMenu.remove();
                contextMenu = null;
            }
        }
        
        // Metadata context menu functionality
        function showMetadataContextMenu(event) {
            event.preventDefault();
            event.stopPropagation();
            hideContextMenu();
            
            contextMenu = d3.select("body")
                .append("div")
                .attr("class", "context-menu")
                .style("left", event.pageX + "px")
                .style("top", event.pageY + "px");
            
            // Add metadata copy options
            contextMenu.append("div")
                .attr("class", "context-menu-item")
                .text("📊 Copy All Metadata")
                .on("click", () => copyAllMetadata());
            
            contextMenu.append("div")
                .attr("class", "context-menu-item")
                .text("📍 Copy IP Addresses")
                .on("click", () => copyAllIPs());
            
            contextMenu.append("div")
                .attr("class", "context-menu-item")
                .text("🔌 Copy Ports")
                .on("click", () => copyAllPorts());
            
            contextMenu.append("div")
                .attr("class", "context-menu-item")
                .text("🔗 Copy IP:Port Pairs")
                .on("click", () => copyIPPortPairs());
            
            contextMenu.append("div").attr("class", "context-menu-separator");
            
            contextMenu.append("div")
                .attr("class", "context-menu-item")
                .text("🌐 Copy Network Stats")
                .on("click", () => copyNetworkStats());
            
            contextMenu.append("div")
                .attr("class", "context-menu-item")
                .text("📋 Copy Connection Summary")
                .on("click", () => copyConnectionSummary());
        }
        
        function copyNodeInfo(d) {
            const info = `Node: ${d.name}
Type: ${d.type}
ID: ${d.id}
Layer: ${d.layer}
${Object.entries(d.details || {}).map(([k, v]) => `${k}: ${v}`).join('\n')}
${d.connection ? `Connection: ${d.connection}` : ''}
${d.hostname ? `Hostname: ${d.hostname}` : ''}
${d.point_code ? `Point Code: ${d.point_code}` : ''}`;
            
            navigator.clipboard.writeText(info).then(() => {
                console.log("Node info copied to clipboard");
                showNotification("Node info copied!");
            }).catch(() => {
                console.log("Failed to copy to clipboard");
                showNotification("Copy failed - check console");
            });
            hideContextMenu();
        }
        
        function copyNodeDetails(d) {
            let details = '';
            if (d.mml_command) {
                details = d.mml_command;
            } else if (d.details) {
                details = Object.entries(d.details)
                    .map(([k, v]) => `${k}: ${v}`)
                    .join('\n');
            }
            
            if (details) {
                navigator.clipboard.writeText(details).then(() => {
                    console.log("Node details copied to clipboard");
                    showNotification("Details copied!");
                }).catch(() => {
                    showNotification("Copy failed - check console");
                });
            }
            hideContextMenu();
        }
        
        function centerOnNode(d) {
            const transform = d3.zoomIdentity
                .translate(width / 2 - d.x, height / 2 - d.y)
                .scale(1.5);
            
            svg.transition()
                .duration(750)
                .call(zoom.transform, transform);
            
            hideContextMenu();
        }
        
        function highlightPath(startNode) {
            // Reset all highlighting
            node.classed("search-match highlighted", false);
            link.classed("flow-path highlighted", false);
            
            // Find and highlight all descendants recursively using the same logic as showConnectedNodes
            const connectedIds = new Set([startNode.id]);
            const highlightedLinks = new Set();
            
            // Function to recursively trace all descendants
            function traceAllDescendants(nodeId, visited = new Set()) {
                if (visited.has(nodeId)) return; // Prevent infinite loops
                visited.add(nodeId);
                connectedIds.add(nodeId);
                
                // Find all connections via links
                links.forEach(link => {
                    const sourceId = typeof link.source === 'object' ? link.source.id : link.source;
                    const targetId = typeof link.target === 'object' ? link.target.id : link.target;
                    
                    if (sourceId === nodeId) {
                        // This node is the source, target is a child
                        connectedIds.add(targetId);
                        highlightedLinks.add(link);
                        traceAllDescendants(targetId, visited);
                    } else if (targetId === nodeId) {
                        // This node is the target, source is a parent
                        connectedIds.add(sourceId);
                        highlightedLinks.add(link);
                        traceAllDescendants(sourceId, visited);
                    }
                });
                
                // Also trace using parent-child relationships from node data
                const currentNode = nodes.find(n => n.id === nodeId);
                if (currentNode) {
                    // Trace upward to parent
                    if (currentNode.parent && !visited.has(currentNode.parent)) {
                        traceAllDescendants(currentNode.parent, visited);
                    }
                    
                    // Trace downward to all children
                    nodes.forEach(node => {
                        if (node.parent === nodeId && !visited.has(node.id)) {
                            traceAllDescendants(node.id, visited);
                        }
                    });
                }
            }
            
            // Start tracing from the selected node
            traceAllDescendants(startNode.id);
            
            // Highlight all connected nodes
            node.filter(d => connectedIds.has(d.id)).classed("highlighted", true);
            
            // Highlight all connected links
            highlightedLinks.forEach(link => {
                const linkSId = typeof link.source === 'object' ? link.source.id : link.source;
                const linkTId = typeof link.target === 'object' ? link.target.id : link.target;
                
                svg.selectAll(".link").filter(l => {
                    const sId = typeof l.source === 'object' ? l.source.id : l.source;
                    const tId = typeof l.target === 'object' ? l.target.id : l.target;
                    return sId === linkSId && tId === linkTId;
                }).classed("flow-path", true);
            });
            
            hideContextMenu();
            showNotification(`Highlighted path from ${startNode.name} (${connectedIds.size} nodes)`);
        }
        
        function showConnectedNodes(d) {
            // Reset highlighting
            node.classed("search-match highlighted", false);
            link.classed("flow-path highlighted", false);
            
            // Highlight the selected node
            node.filter(n => n.id === d.id).classed("highlighted", true);
            
            // Find and highlight all descendants recursively (children, grandchildren, etc.)
            const connectedIds = new Set([d.id]);
            const highlightedLinks = new Set();
            
            // Function to recursively trace all descendants
            function traceAllDescendants(nodeId, visited = new Set()) {
                if (visited.has(nodeId)) return; // Prevent infinite loops
                visited.add(nodeId);
                connectedIds.add(nodeId);
                
                // Find all connections via links
                links.forEach(link => {
                    const sourceId = typeof link.source === 'object' ? link.source.id : link.source;
                    const targetId = typeof link.target === 'object' ? link.target.id : link.target;
                    
                    if (sourceId === nodeId) {
                        // This node is the source, target is a child
                        connectedIds.add(targetId);
                        highlightedLinks.add(link);
                        traceAllDescendants(targetId, visited);
                    } else if (targetId === nodeId) {
                        // This node is the target, source is a parent
                        connectedIds.add(sourceId);
                        highlightedLinks.add(link);
                        traceAllDescendants(sourceId, visited);
                    }
                });
                
                // Also trace using parent-child relationships from node data
                const currentNode = nodes.find(n => n.id === nodeId);
                if (currentNode) {
                    // Trace upward to parent
                    if (currentNode.parent && !visited.has(currentNode.parent)) {
                        traceAllDescendants(currentNode.parent, visited);
                    }
                    
                    // Trace downward to all children
                    nodes.forEach(node => {
                        if (node.parent === nodeId && !visited.has(node.id)) {
                            traceAllDescendants(node.id, visited);
                        }
                    });
                }
            }
            
            // Start tracing from the selected node
            traceAllDescendants(d.id);
            
            // Highlight all connected nodes
            node.filter(n => connectedIds.has(n.id)).classed("highlighted", true);
            
            // Highlight all connected links
            highlightedLinks.forEach(link => {
                const linkSId = typeof link.source === 'object' ? link.source.id : link.source;
                const linkTId = typeof link.target === 'object' ? link.target.id : link.target;
                
                svg.selectAll(".link").filter(l => {
                    const sId = typeof l.source === 'object' ? l.source.id : l.source;
                    const tId = typeof l.target === 'object' ? l.target.id : l.target;
                    return sId === linkSId && tId === linkTId;
                }).classed("flow-path", true);
            });
            
            hideContextMenu();
            showNotification(`Showing ${connectedIds.size} nodes connected to ${d.name} (including all descendants)`);
        }
        
        function addToSelection(d) {
            selectedNodes.add(d.id);
            node.filter(n => n.id === d.id).classed("selected", true);
            hideContextMenu();
            showNotification(`Added ${d.name} to selection (${selectedNodes.size} selected)`);
        }
        
        function pinNode(d) {
            d.fx = d.x;
            d.fy = d.y;
            hideContextMenu();
            showNotification(`Pinned ${d.name} at current position`);
        }
        
        function unpinNode(d) {
            d.fx = null;
            d.fy = null;
            simulation.alpha(0.3).restart();
            hideContextMenu();
            showNotification(`Unpinned ${d.name} - will move freely`);
        }
        
        function showNotification(message) {
            // Remove any existing notification
            d3.selectAll(".notification").remove();
            
            const notification = d3.select("body")
                .append("div")
                .attr("class", "notification")
                .text(message);
            
            // Trigger animation
            setTimeout(() => notification.classed("show", true), 10);
            
            // Auto-remove after 3 seconds
            setTimeout(() => {
                notification.classed("show", false);
                setTimeout(() => notification.remove(), 300);
            }, 3000);
        }
        
        // Network metadata copy functions
        function copyNetworkMetadata() {
            const metadata = {
                totalNodes: nodes.length,
                totalLinks: links.length,
                protocols: Array.from(new Set(links.map(l => l.protocol))),
                nodeTypes: {},
                allIPs: ["172.21.1.10", "172.21.1.101", "172.21.1.102", "172.21.1.103", "172.21.128.101", "172.21.128.102", "172.21.128.103", "172.21.128.104", "172.21.128.105", "172.21.128.110", "172.21.129.100", "172.25.8.9", "IPADDR1", "IPv4", "Local SPS Entity", "M2UA Link Set", "M2UA Signal Gateway"],
                allPorts: ["1025", "1026", "1027", "1028", "1125", "1126", "1127", "1128", "1225", "1226", "5000", "5001", "5002", "5003", "5004", "5005", "5006", "5007", "5008", "5010", "5011", "5012", "5013"],
                ipPortPairs: ["172.21.1.101:5005", "172.21.1.101:5007", "172.21.1.102:5006", "172.21.1.102:5008", "172.21.1.103:5001", "172.21.1.103:5002", "172.21.1.10:1025", "172.21.1.10:1026", "172.21.128.101:5005", "172.21.128.101:5006", "172.21.128.101:5007", "172.21.128.101:5008", "172.21.128.102:5010", "172.21.128.102:5011", "172.21.128.102:5012", "172.21.128.102:5013", "172.21.128.103:5001", "172.21.128.103:5002", "172.21.128.103:5003", "172.21.128.103:5004", "172.21.128.104:1125", "172.21.128.104:1126", "172.21.128.104:1127", "172.21.128.104:1128", "172.21.128.105:1025", "172.21.128.105:1026", "172.21.128.105:1027", "172.21.128.105:1028", "172.21.128.110:1225", "172.21.128.110:1226", "172.21.129.100:1125", "172.21.129.100:1126", "172.25.8.9:5000"],
                timestamp: new Date().toISOString(),
                source: 'SPS Network Topology Visualization'
            };
            
            // Count node types
            nodes.forEach(node => {
                metadata.nodeTypes[node.type] = (metadata.nodeTypes[node.type] || 0) + 1;
            });
            
            const metadataText = `SPS Network Topology - Complete Metadata
========================================
Generated: ${metadata.timestamp}
Source: ${metadata.source}

Network Summary:
- Total Nodes: ${metadata.totalNodes}
- Total Links: ${metadata.totalLinks}
- Protocols: ${metadata.protocols.join(', ')}
- IP Addresses: ${metadata.allIPs.length}
- Ports: ${metadata.allPorts.length}
- IP:Port Pairs: ${metadata.ipPortPairs.length}

Node Type Distribution:
${Object.entries(metadata.nodeTypes).map(([type, count]) => `- ${type}: ${count}`).join('\n')}

All IP Addresses:
${metadata.allIPs.join('\n')}

All Ports:
${metadata.allPorts.join('\n')}

IP:Port Connection Pairs:
${metadata.ipPortPairs.join('\n')}

Raw JSON Metadata:
${JSON.stringify(metadata, null, 2)}`;
            
            navigator.clipboard.writeText(metadataText).then(() => {
                showNotification("Complete network metadata copied to clipboard!");
            }).catch(() => {
                showNotification("Copy failed - check console");
            });
            hideContextMenu();
        }
        
        function copyAllIPs() {
            const allIPs = ["172.21.1.10", "172.21.1.101", "172.21.1.102", "172.21.1.103", "172.21.128.101", "172.21.128.102", "172.21.128.103", "172.21.128.104", "172.21.128.105", "172.21.128.110", "172.21.129.100", "172.25.8.9", "IPADDR1", "IPv4", "Local SPS Entity", "M2UA Link Set", "M2UA Signal Gateway"];
            const ipText = `SPS Network - All IP Addresses (${allIPs.length} total)
================================================================
${allIPs.join('\n')}`;
            
            navigator.clipboard.writeText(ipText).then(() => {
                showNotification(`Copied ${allIPs.length} IP addresses to clipboard!`);
            }).catch(() => {
                showNotification("Copy failed - check console");
            });
            hideContextMenu();
        }
        
        function copyAllPorts() {
            const allPorts = ["1025", "1026", "1027", "1028", "1125", "1126", "1127", "1128", "1225", "1226", "5000", "5001", "5002", "5003", "5004", "5005", "5006", "5007", "5008", "5010", "5011", "5012", "5013"];
            const portText = `SPS Network - All Ports (${allPorts.length} total)
==================================================
${allPorts.join('\n')}`;
            
            navigator.clipboard.writeText(portText).then(() => {
                showNotification(`Copied ${allPorts.length} ports to clipboard!`);
            }).catch(() => {
                showNotification("Copy failed - check console");
            });
            hideContextMenu();
        }
        
        function copyIPPortPairs() {
            const ipPortPairs = ["172.21.1.101:5005", "172.21.1.101:5007", "172.21.1.102:5006", "172.21.1.102:5008", "172.21.1.103:5001", "172.21.1.103:5002", "172.21.1.10:1025", "172.21.1.10:1026", "172.21.128.101:5005", "172.21.128.101:5006", "172.21.128.101:5007", "172.21.128.101:5008", "172.21.128.102:5010", "172.21.128.102:5011", "172.21.128.102:5012", "172.21.128.102:5013", "172.21.128.103:5001", "172.21.128.103:5002", "172.21.128.103:5003", "172.21.128.103:5004", "172.21.128.104:1125", "172.21.128.104:1126", "172.21.128.104:1127", "172.21.128.104:1128", "172.21.128.105:1025", "172.21.128.105:1026", "172.21.128.105:1027", "172.21.128.105:1028", "172.21.128.110:1225", "172.21.128.110:1226", "172.21.129.100:1125", "172.21.129.100:1126", "172.25.8.9:5000"];
            const pairText = `SPS Network - All IP:Port Connection Pairs (${ipPortPairs.length} total)
==================================================================
${ipPortPairs.join('\n')}`;
            
            navigator.clipboard.writeText(pairText).then(() => {
                showNotification(`Copied ${ipPortPairs.length} IP:Port pairs to clipboard!`);
            }).catch(() => {
                showNotification("Copy failed - check console");
            });
            hideContextMenu();
        }
        
        // New metadata copy functions
        function copyAllMetadata() {
            const metadata = {
                totalNodes: nodes.length,
                totalLinks: links.length,
                protocols: Array.from(new Set(links.map(l => l.protocol))),
                nodeTypes: {},
                allIPs: ["172.21.1.10", "172.21.1.101", "172.21.1.102", "172.21.1.103", "172.21.128.101", "172.21.128.102", "172.21.128.103", "172.21.128.104", "172.21.128.105", "172.21.128.110", "172.21.129.100", "172.25.8.9", "IPADDR1", "IPv4", "Local SPS Entity", "M2UA Link Set", "M2UA Signal Gateway"],
                allPorts: ["1025", "1026", "1027", "1028", "1125", "1126", "1127", "1128", "1225", "1226", "5000", "5001", "5002", "5003", "5004", "5005", "5006", "5007", "5008", "5010", "5011", "5012", "5013"],
                ipPortPairs: ["172.21.1.101:5005", "172.21.1.101:5007", "172.21.1.102:5006", "172.21.1.102:5008", "172.21.1.103:5001", "172.21.1.103:5002", "172.21.1.10:1025", "172.21.1.10:1026", "172.21.128.101:5005", "172.21.128.101:5006", "172.21.128.101:5007", "172.21.128.101:5008", "172.21.128.102:5010", "172.21.128.102:5011", "172.21.128.102:5012", "172.21.128.102:5013", "172.21.128.103:5001", "172.21.128.103:5002", "172.21.128.103:5003", "172.21.128.103:5004", "172.21.128.104:1125", "172.21.128.104:1126", "172.21.128.104:1127", "172.21.128.104:1128", "172.21.128.105:1025", "172.21.128.105:1026", "172.21.128.105:1027", "172.21.128.105:1028", "172.21.128.110:1225", "172.21.128.110:1226", "172.21.129.100:1125", "172.21.129.100:1126", "172.25.8.9:5000"],
                timestamp: new Date().toISOString(),
                source: 'SPS Network Topology Visualization'
            };
            
            // Count node types
            nodes.forEach(node => {
                metadata.nodeTypes[node.type] = (metadata.nodeTypes[node.type] || 0) + 1;
            });
            
            const metadataText = `SPS Network Topology - Complete Metadata
========================================
Generated: ${metadata.timestamp}
Source: ${metadata.source}

Network Summary:
- Total Nodes: ${metadata.totalNodes}
- Total Links: ${metadata.totalLinks}
- Protocols: ${metadata.protocols.join(', ')}
- IP Addresses: ${metadata.allIPs.length}
- Ports: ${metadata.allPorts.length}
- IP:Port Pairs: ${metadata.ipPortPairs.length}

Node Type Distribution:
${Object.entries(metadata.nodeTypes).map(([type, count]) => `- ${type}: ${count}`).join('\n')}

All IP Addresses:
${metadata.allIPs.join('\n')}

All Ports:
${metadata.allPorts.join('\n')}

IP:Port Connection Pairs:
${metadata.ipPortPairs.join('\n')}

Raw JSON Metadata:
${JSON.stringify(metadata, null, 2)}`;
            
            navigator.clipboard.writeText(metadataText).then(() => {
                showNotification("Complete network metadata copied to clipboard!");
            }).catch(() => {
                showNotification("Copy failed - check console");
            });
            hideContextMenu();
        }
        
        function copyNetworkStats() {
            const stats = {
                totalNodes: nodes.length,
                totalLinks: links.length,
                protocols: Array.from(new Set(links.map(l => l.protocol))),
                ipCount: 17,
                portCount: 23,
                connectionCount: 33,
                nodeTypes: {}
            };
            
            nodes.forEach(node => {
                stats.nodeTypes[node.type] = (stats.nodeTypes[node.type] || 0) + 1;
            });
            
            const statsText = `SPS Network Statistics
======================
Total Nodes: ${stats.totalNodes}
Total Links: ${stats.totalLinks}
Protocols: ${stats.protocols.join(', ')}
IP Addresses: ${stats.ipCount}
Ports: ${stats.portCount}
Connections: ${stats.connectionCount}

Node Distribution:
${Object.entries(stats.nodeTypes).map(([type, count]) => `${type}: ${count}`).join('\n')}`;
            
            navigator.clipboard.writeText(statsText).then(() => {
                showNotification("Network statistics copied to clipboard!");
            }).catch(() => {
                showNotification("Copy failed - check console");
            });
            hideContextMenu();
        }
        
        function copyConnectionSummary() {
            const connections = ["172.21.1.101:5005", "172.21.1.101:5007", "172.21.1.102:5006", "172.21.1.102:5008", "172.21.1.103:5001", "172.21.1.103:5002", "172.21.1.10:1025", "172.21.1.10:1026", "172.21.128.101:5005", "172.21.128.101:5006", "172.21.128.101:5007", "172.21.128.101:5008", "172.21.128.102:5010", "172.21.128.102:5011", "172.21.128.102:5012", "172.21.128.102:5013", "172.21.128.103:5001", "172.21.128.103:5002", "172.21.128.103:5003", "172.21.128.103:5004", "172.21.128.104:1125", "172.21.128.104:1126", "172.21.128.104:1127", "172.21.128.104:1128", "172.21.128.105:1025", "172.21.128.105:1026", "172.21.128.105:1027", "172.21.128.105:1028", "172.21.128.110:1225", "172.21.128.110:1226", "172.21.129.100:1125", "172.21.129.100:1126", "172.25.8.9:5000"];
            const connectionsByProtocol = {};
            
            links.forEach(link => {
                if (!connectionsByProtocol[link.protocol]) {
                    connectionsByProtocol[link.protocol] = [];
                }
                connectionsByProtocol[link.protocol].push(link);
            });
            
            let summaryText = `SPS Network Connection Summary
===============================
Total Connections: ${connections.length}

Connections by Protocol:
${Object.entries(connectionsByProtocol).map(([protocol, links]) => 
    `${protocol}: ${links.length} connections`).join('\n')}

All Connection Details:
${connections.join('\n')}`;
            
            navigator.clipboard.writeText(summaryText).then(() => {
                showNotification("Connection summary copied to clipboard!");
            }).catch(() => {
                showNotification("Copy failed - check console");
            });
            hideContextMenu();
        }
        
        // Click outside to hide context menu
        d3.select("body").on("click", hideContextMenu);
        
        // Layout control functions
        // Enhanced node selection and interaction
        function enhancedNodeClick(event, d) {
            event.stopPropagation();
            
            if (event.shiftKey) {
                // Multi-select with Shift
                if (selectedNodes.has(d.id)) {
                    selectedNodes.delete(d.id);
                    d3.select(this).classed("selected", false);
                } else {
                    selectedNodes.add(d.id);
                    d3.select(this).classed("selected", true);
                }
            } else if (event.ctrlKey || event.metaKey) {
                // Toggle selection with Ctrl/Cmd
                if (selectedNodes.has(d.id)) {
                    selectedNodes.delete(d.id);
                    d3.select(this).classed("selected", false);
                } else {
                    selectedNodes.add(d.id);
                    d3.select(this).classed("selected", true);
                }
            } else {
                // Single select (clear others)
                clearSelection();
                selectedNodes.add(d.id);
                d3.select(this).classed("selected", true);
                
                // Zoom to clicked node
                const transform = d3.zoomIdentity
                    .translate(width / 2 - d.x, height / 2 - d.y)
                    .scale(1.5);
                
                svg.transition()
                    .duration(750)
                    .call(zoom.transform, transform);
            }
        }
        
        function clearSelection() {
            selectedNodes.clear();
            node.classed("selected", false);
        }
        
        // Enhanced drag behavior with group dragging
        function enhancedDrag(simulation) {
            function dragstarted(event, d) {
                if (!event.active) simulation.alphaTarget(0.3).restart();
                
                if (!selectedNodes.has(d.id)) {
                    // If dragging a non-selected node, select it
                    if (!event.shiftKey && !event.ctrlKey && !event.metaKey) {
                        clearSelection();
                    }
                    selectedNodes.add(d.id);
                    d3.select(this).classed("selected", true);
                }
                
                // Set fixed positions for all selected nodes
                selectedNodes.forEach(nodeId => {
                    const nodeData = nodes.find(n => n.id === nodeId);
                    if (nodeData) {
                        nodeData.fx = nodeData.x;
                        nodeData.fy = nodeData.y;
                    }
                });
            }
            
            function dragged(event, d) {
                const dx = event.x - d.x;
                const dy = event.y - d.y;
                
                // Move all selected nodes together
                selectedNodes.forEach(nodeId => {
                    const nodeData = nodes.find(n => n.id === nodeId);
                    if (nodeData) {
                        nodeData.fx += dx;
                        nodeData.fy += dy;
                    }
                });
            }
            
            function dragended(event, d) {
                if (!event.active) simulation.alphaTarget(0);
                
                // Release fixed positions
                selectedNodes.forEach(nodeId => {
                    const nodeData = nodes.find(n => n.id === nodeId);
                    if (nodeData) {
                        nodeData.fx = null;
                        nodeData.fy = null;
                    }
                });
            }
            
            return d3.drag()
                .on("start", dragstarted)
                .on("drag", dragged)
                .on("end", dragended);
        }
        
        // Zoom and pan handlers
        function handleZoom(event) {
            g.attr("transform", event.transform);
        }
        
        function zoomIn() {
            svg.transition().duration(300).call(
                zoom.scaleBy, 1.5
            );
        }
        
        function zoomOut() {
            svg.transition().duration(300).call(
                zoom.scaleBy, 1 / 1.5
            );
        }
        
        function resetZoom() {
            svg.transition().duration(500).call(
                zoom.transform,
                d3.zoomIdentity.translate(0, 0).scale(1)
            );
        }
        
        // Scale control functions for layout spacing
        function scaleOut() {
            layoutMultiplier = Math.min(layoutMultiplier * 1.2, 3.0);
            updateLayoutMultiplier();
        }
        
        function scaleIn() {
            layoutMultiplier = Math.max(layoutMultiplier / 1.2, 0.3);
            updateLayoutMultiplier();
        }
        
        function resetScale() {
            layoutMultiplier = 1.0;
            updateLayoutMultiplier();
        }
        
        function updateLayoutMultiplier() {
            // Update force simulation with new layout multiplier
            simulation
                .force("link", d3.forceLink()
                    .id(d => d.id)
                    .distance(d => {
                        const baseDistance = d.type === 'main' ? 150 : 
                                           d.source.layer === 1 ? 120 : 80;
                        return baseDistance * layoutMultiplier;
                    })
                )
                .force("charge", d3.forceManyBody()
                    .strength(d => {
                        const baseStrength = d.layer === 0 ? -2000 : -800;
                        return baseStrength * layoutMultiplier;
                    })
                )
                .force("collision", d3.forceCollide()
                    .radius(d => (d.size + 8) * layoutMultiplier)
                )
                .force("radial", d3.forceRadial(d => {
                    const baseRadius = d.layer * 200 + 100;
                    return baseRadius * layoutMultiplier;
                }, width / 2, height / 2));
            
            // Re-link the data to the updated force
            simulation.force("link").links(links);
            
            // Restart simulation to apply changes
            simulation.alpha(0.5).restart();
        }
        
        // Drag behavior with improved constraints
        function drag(simulation) {
            function dragstarted(event) {
                if (!event.active) simulation.alphaTarget(0.3).restart();
                event.subject.fx = event.subject.x;
                event.subject.fy = event.subject.y;
            }
            
            function dragged(event) {
                event.subject.fx = event.x;
                event.subject.fy = event.y;
            }
            
            function dragended(event) {
                if (!event.active) simulation.alphaTarget(0);
                event.subject.fx = null;
                event.subject.fy = null;
            }
            
            return d3.drag()
                .on("start", dragstarted)
                .on("drag", dragged)
                .on("end", dragended);
        }
        
        // Tooltip functions
        function showTooltip(event, d) {
            const details = Object.entries(d.details || {})
                .map(([key, value]) => `<div>${key}:</div><div>${value}</div>`)
                .join('');
            
            tooltip.transition()
                .duration(200)
                .style("opacity", .9);
            
            tooltip.html(`
                <h4>${d.name}</h4>
                <div class="tooltip-content">
                    ${details}
                </div>
            `);
        }
        
        function moveTooltip(event) {
            tooltip
                .style("left", (event.pageX + 10) + "px")
                .style("top", (event.pageY - 28) + "px");
        }
        
        function hideTooltip() {
            tooltip.transition()
                .duration(500)
                .style("opacity", 0);
        }
        
        function nodeClick(event, d) {
            console.log("Clicked node:", d);
            // Zoom to clicked node
            const transform = d3.zoomIdentity
                .translate(width / 2 - d.x, height / 2 - d.y)
                .scale(1.5);
            
            svg.transition()
                .duration(750)
                .call(zoom.transform, transform);
        }
        
        // Control functions
        function restartSimulation() {
            simulation.alpha(1).restart();
        }
        
        function centerView() {
            resetZoom();
            simulation.force("center", d3.forceCenter(width / 2, height / 2));
            simulation.alpha(0.3).restart();
        }
        
        function toggleLabels() {
            labelsVisible = !labelsVisible;
            labels.style("opacity", labelsVisible ? 1 : 0);
            document.getElementById("labelBtn").style.background = 
                labelsVisible ? "linear-gradient(45deg, #4ECDC4, #44A08D)" : "linear-gradient(45deg, #ff6b6b, #ff8e8e)";
        }
        
        function filterProtocol(protocol) {
            // Store current protocol filter
            currentProtocolFilter = protocol;
            
            // Update button states
            document.querySelectorAll('.protocol-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            document.getElementById(`btn_${protocol}`).classList.add('active');
            
            // Update status and apply combined filter
            updateFilterStatus();
            applyCombinedFilter();
        }
        
        function showAll() {
            // Clear protocol filter
            currentProtocolFilter = null;
            
            // Update button states
            document.querySelectorAll('.protocol-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            document.getElementById('btnAll').classList.add('active');
            
            // Update status and apply combined filter (will show search results if any, otherwise show all)
            updateFilterStatus();
            applyCombinedFilter();
        }
        
        function getNodeProtocol(node) {
            // Find the protocol by checking connected links
            const connectedLink = links.find(l => 
                l.source.id === node.id || l.target.id === node.id
            );
            return connectedLink ? connectedLink.protocol : 'UNKNOWN';
        }
        
        // Keyboard shortcuts
        document.addEventListener('keydown', function(event) {
            if (event.key === 'Escape') {
                clearSearch();
                clearSelection();
                showAll();
            } else if (event.key === 'Delete' && selectedNodes.size > 0) {
                // Could implement node deletion here
                console.log('Delete pressed with selected nodes:', Array.from(selectedNodes));
            } else if (event.ctrlKey || event.metaKey) {
                if (event.key === 'a') {
                    event.preventDefault();
                    // Select all nodes
                    selectedNodes.clear();
                    nodes.forEach(n => selectedNodes.add(n.id));
                    node.classed("selected", true);
                } else if (event.key === 'f') {
                    event.preventDefault();
                    // Focus on search input
                    document.getElementById('searchInput').focus();
                }
            }
        });
        
        // Resize handler
        window.addEventListener('resize', () => {
            const newRect = container.node().getBoundingClientRect();
            const newWidth = newRect.width;
            const newHeight = newRect.height;
            
            svg.attr("width", newWidth).attr("height", newHeight);
            simulation.force("center", d3.forceCenter(newWidth / 2, newHeight / 2));
            simulation.alpha(0.3).restart();
        });
        
        // Initialize with enhanced features
        console.log("🚀 Enhanced SPS Topology loaded with", nodes.length, "nodes and", links.length, "links");
        console.log("🔍 Features: LED breathing search, RegExp support, multi-select, layout controls");
        console.log("⌨️  Shortcuts: Ctrl+A (select all), Ctrl+F (search), Esc (clear), Shift+Click (multi-select)");
        console.log("🎛️  Controls: Ctrl+Drag (rectangle select), Shift+Drag (group move)");
        console.log("🌐 Protocols:", ['DIAMETER', 'MTP', 'M3UA', 'M2UA']);
    </script>
</body>
</html>